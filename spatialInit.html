<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Initialising the plus group in spatial models | Alaskan sablefish research</title>
  <meta name="description" content="This Gitbook documents my post-doctoral research relating to Alaskan sablefish." />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Initialising the plus group in spatial models | Alaskan sablefish research" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This Gitbook documents my post-doctoral research relating to Alaskan sablefish." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Initialising the plus group in spatial models | Alaskan sablefish research" />
  
  <meta name="twitter:description" content="This Gitbook documents my post-doctoral research relating to Alaskan sablefish." />
  

<meta name="author" content="C.Marsh" />


<meta name="date" content="2022-11-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Fexplore.html"/>
<link rel="next" href="spatialmodelInputs.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Sablefish Research</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#future-things-to-consider"><i class="fa fa-check"></i>Future things to consider</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#chapter-overview"><i class="fa fa-check"></i>chapter overview</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="objectives.html"><a href="objectives.html"><i class="fa fa-check"></i><b>2</b> A list of objectives/milestones that we have set along the project life</a></li>
<li class="chapter" data-level="3" data-path="modeldescription.html"><a href="modeldescription.html"><i class="fa fa-check"></i><b>3</b> Current Alaskan sablefish stock assessment model</a>
<ul>
<li class="chapter" data-level="3.1" data-path="modeldescription.html"><a href="modeldescription.html#modelequations"><i class="fa fa-check"></i><b>3.1</b> Process equations</a>
<ul>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#initialisation-gleft.right"><i class="fa fa-check"></i>Initialisation (<span class="math inline">\(g\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#population-dynamics-fleft.right"><i class="fa fa-check"></i>Population dynamics (<span class="math inline">\(f\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#determining-selectivities-for-fisheries-and-surveys"><i class="fa fa-check"></i>Determining selectivities for fisheries and surveys</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="modeldescription.html"><a href="modeldescription.html#observationsection"><i class="fa fa-check"></i><b>3.2</b> Observation equations</a>
<ul>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#catch-at-age"><i class="fa fa-check"></i>Catch at age</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#relative-abundance-indices"><i class="fa fa-check"></i>Relative abundance indices</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#catch-at-length"><i class="fa fa-check"></i>Catch at length</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#observations-for-fisheries-and-surveys"><i class="fa fa-check"></i>Observations for fisheries and surveys</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="modeldescription.html"><a href="modeldescription.html#symbols"><i class="fa fa-check"></i><b>3.3</b> Symbol Notation</a>
<ul>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#inference"><i class="fa fa-check"></i>Inference</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#todo"><i class="fa fa-check"></i>TODO</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html"><i class="fa fa-check"></i><b>4</b> Spatial stock assessment model for Alaskan sablefish</a>
<ul>
<li class="chapter" data-level="4.1" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#spatialmodelequations"><i class="fa fa-check"></i><b>4.1</b> Process equations</a>
<ul>
<li class="chapter" data-level="" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#initialisation-gleft.right-1"><i class="fa fa-check"></i>Initialisation (<span class="math inline">\(g\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#population-dynamics-fleft.right-1"><i class="fa fa-check"></i>Population dynamics (<span class="math inline">\(f\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#to-do"><i class="fa fa-check"></i>To DO</a></li>
<li class="chapter" data-level="" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#appendix"><i class="fa fa-check"></i>Appendix</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sexratios.html"><a href="sexratios.html"><i class="fa fa-check"></i><b>5</b> Sex ratios in age and length composition data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sexratios.html"><a href="sexratios.html#sexSimulation"><i class="fa fa-check"></i><b>5.1</b> A simple simulation</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="sexratios.html"><a href="sexratios.html#results"><i class="fa fa-check"></i><b>5.1.1</b> Results</a></li>
<li class="chapter" data-level="" data-path="sexratios.html"><a href="sexratios.html#future-research-that-was-not-considered-in-this-simple-simulation"><i class="fa fa-check"></i>Future research that was not considered in this simple simulation</a></li>
<li class="chapter" data-level="5.1.2" data-path="sexratios.html"><a href="sexratios.html#scenario-1"><i class="fa fa-check"></i><b>5.1.2</b> Scenario 1</a></li>
<li class="chapter" data-level="5.1.3" data-path="sexratios.html"><a href="sexratios.html#scenario-2"><i class="fa fa-check"></i><b>5.1.3</b> Scenario 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Fexplore.html"><a href="Fexplore.html"><i class="fa fa-check"></i><b>6</b> Fishing mortality approaches</a>
<ul>
<li class="chapter" data-level="" data-path="Fexplore.html"><a href="Fexplore.html#set-up-a-simulation"><i class="fa fa-check"></i>Set up a simulation</a></li>
<li class="chapter" data-level="" data-path="Fexplore.html"><a href="Fexplore.html#appendix---hybrid-approach"><i class="fa fa-check"></i>Appendix - Hybrid approach</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="spatialInit.html"><a href="spatialInit.html"><i class="fa fa-check"></i><b>7</b> Initialising the plus group in spatial models</a></li>
<li class="chapter" data-level="8" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html"><i class="fa fa-check"></i><b>8</b> Spatial model inputs</a>
<ul>
<li class="chapter" data-level="8.1" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#surveyData"><i class="fa fa-check"></i><b>8.1</b> Survey data</a>
<ul>
<li class="chapter" data-level="" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#abundance"><i class="fa fa-check"></i>Abundance</a></li>
<li class="chapter" data-level="" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#age-frequency"><i class="fa fa-check"></i>Age-frequency</a></li>
<li class="chapter" data-level="" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#length-frequency"><i class="fa fa-check"></i>Length-frequency</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#ObserverData"><i class="fa fa-check"></i><b>8.2</b> Observer data</a></li>
<li class="chapter" data-level="8.3" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#CatchData"><i class="fa fa-check"></i><b>8.3</b> Catch data</a></li>
<li class="chapter" data-level="" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#appendix-1"><i class="fa fa-check"></i>Appendix</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tagdata.html"><a href="tagdata.html"><i class="fa fa-check"></i><b>9</b> Tagging data and studies</a>
<ul>
<li class="chapter" data-level="9.1" data-path="tagdata.html"><a href="tagdata.html#integrating-tagging-observations-in-spatial-age-structured-models"><i class="fa fa-check"></i><b>9.1</b> Integrating tagging observations in spatial age-structured models</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#releasing-tags"><i class="fa fa-check"></i>Releasing tags</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#tag-recovery-observations"><i class="fa fa-check"></i>Tag recovery observations</a></li>
<li class="chapter" data-level="9.2" data-path="tagdata.html"><a href="tagdata.html#growth-estimation-using-the-laslettevesonpolacheck-lep-method"><i class="fa fa-check"></i><b>9.2</b> Growth estimation using the Laslett–Eveson–Polacheck (LEP) method</a>
<ul>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#age-at-length-growth-model"><i class="fa fa-check"></i>Age-at-length growth model</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#tag-recapture-growth-data"><i class="fa fa-check"></i>Tag recapture growth data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#simulation-test-the-lep-method"><i class="fa fa-check"></i>Simulation test the “LEP” method</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#next-steps"><i class="fa fa-check"></i>Next steps</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="refpoints.html"><a href="refpoints.html"><i class="fa fa-check"></i><b>10</b> Review/summarise reference points</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://www.fisheries.noaa.gov/alaska/science-data/alaska-sablefish-fisheries-and-assessment" target="blank">NOAA Website</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Alaskan sablefish research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatialInit" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Initialising the plus group in spatial models<a href="spatialInit.html#spatialInit" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In single area age-structured models, the plus age group is calculated using a solution to an infinite geometric series. This solution for an age-structured model is used to derive initial (equilibrium) state of the partition. The partition consists of a vector of numbers at age for each category denoted by <span class="math inline">\(\textbf{N}\)</span>;
<span class="math display">\[
\textbf{N} = (N_1, N_2, ... , N_{a_+})^T
\]</span></p>
<p>where <span class="math inline">\(N_{a_+}\)</span> denotes the numbers in the plus group. The numbers at age for a single area population with no density-dependent processes is derived as,</p>
<p><span class="math display">\[
N_a = \left\{ \begin{array}{lcl}
    R_0 &amp; \mbox{for} &amp; a = 1
    \\
    R_0e^{-aM}  &amp; \mbox{for} &amp; 1 &lt; a &lt; a_+
    \\
    R_0e^{\sum_{i = a_+}^\infty-iM} &amp; \mbox{for} &amp; a = a_+
\end{array}\right.
\]</span></p>
<p>Initialization for ages <span class="math inline">\(1 \leq a &lt; a_+\)</span> is easy, all you need to do is iterate the model <span class="math inline">\(a_+ - 1\)</span> times and the age classes will be populated with there respected initial numbers at age. However, for the plus group (<span class="math inline">\(N_{a_+}\)</span>) the solution is needed.</p>
<p>Although the plus group may start at let say 30 years old, it actually represents 30 and 31 and 32 up to some biological plausible value lets say 130, but mathematically can be thought of as <span class="math inline">\(\infty\)</span>. The plus group is modeled for practical reasons and care should be given when choosing the cut-off maximum age. The plus group is an infinite geometric series that is defined by the common ratio <span class="math inline">\(r_{a_+}\)</span>.</p>
<p><span class="math display">\[\begin{align}
N_{a_+} &amp;= R_0e^{\sum_{a = a_+}^\infty-aM}\\
        &amp;= R_0 \frac{e^{M - a_+M}}{1 - e^{-M}}
\end{align}\]</span></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="spatialInit.html#cb25-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb25-2"><a href="spatialInit.html#cb25-2" aria-hidden="true" tabindex="-1"></a>R0 <span class="ot">=</span> <span class="fl">4e6</span></span>
<span id="cb25-3"><a href="spatialInit.html#cb25-3" aria-hidden="true" tabindex="-1"></a>plus_group_age <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb25-4"><a href="spatialInit.html#cb25-4" aria-hidden="true" tabindex="-1"></a>N_age <span class="ot">=</span> R0 <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M <span class="sc">*</span> <span class="dv">1</span><span class="sc">:</span>plus_group_age)</span>
<span id="cb25-5"><a href="spatialInit.html#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="do">## numerically calculate it</span></span>
<span id="cb25-6"><a href="spatialInit.html#cb25-6" aria-hidden="true" tabindex="-1"></a>N_plus_group <span class="ot">=</span>  <span class="fu">tail</span>(N_age, <span class="at">n =</span> <span class="dv">1</span>)</span>
<span id="cb25-7"><a href="spatialInit.html#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10000</span>) {</span>
<span id="cb25-8"><a href="spatialInit.html#cb25-8" aria-hidden="true" tabindex="-1"></a>  N_plus_group <span class="ot">=</span> N_plus_group <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M) <span class="sc">+</span> <span class="fu">tail</span>(N_age, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M)</span>
<span id="cb25-9"><a href="spatialInit.html#cb25-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-10"><a href="spatialInit.html#cb25-10" aria-hidden="true" tabindex="-1"></a>N_plus_group</span></code></pre></div>
<pre><code>## [1] 1893568</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="spatialInit.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## using the geometric series calculation</span></span>
<span id="cb27-2"><a href="spatialInit.html#cb27-2" aria-hidden="true" tabindex="-1"></a>R0 <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M <span class="sc">-</span> plus_group_age<span class="sc">*</span>M) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>M))</span></code></pre></div>
<pre><code>## [1] 1893568</code></pre>
<p>The question becomes, how do we calculate this plus group when there is markovian movement as well as? This code shows how the same infinite geometric series solution works for the plus group with movement. Instead of using just natural mortality (<span class="math inline">\(M\)</span>) you also need how much the plus group accumulates from the movement process. Let <span class="math inline">\(c\)</span> denote the initial accumulation the plus group in a given region receives from ageing, natural mortality and movement. Then the plus group for that region can be</p>
<p><span class="math display">\[
N_{a+, r} = N_{a+ - 1, r} \frac{1}{1 - c}
\]</span>
where, <span class="math inline">\(N_{a+ - 1, r}\)</span> is the numbers at age for the second to last age cohort in the plus group. The following R code shows how this is equivalent to running the annual cycle for 1000 years.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="spatialInit.html#cb29-1" aria-hidden="true" tabindex="-1"></a>M <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb29-2"><a href="spatialInit.html#cb29-2" aria-hidden="true" tabindex="-1"></a>R0 <span class="ot">=</span> <span class="fl">4e6</span></span>
<span id="cb29-3"><a href="spatialInit.html#cb29-3" aria-hidden="true" tabindex="-1"></a>n_regions <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb29-4"><a href="spatialInit.html#cb29-4" aria-hidden="true" tabindex="-1"></a>movement_matrix <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n_regions, <span class="at">ncol =</span> n_regions);</span>
<span id="cb29-5"><a href="spatialInit.html#cb29-5" aria-hidden="true" tabindex="-1"></a>movement_matrix[<span class="dv">1</span>,] <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>)</span>
<span id="cb29-6"><a href="spatialInit.html#cb29-6" aria-hidden="true" tabindex="-1"></a>movement_matrix[<span class="dv">2</span>,] <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="fl">0.3</span>)</span>
<span id="cb29-7"><a href="spatialInit.html#cb29-7" aria-hidden="true" tabindex="-1"></a>movement_matrix[<span class="dv">3</span>,] <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.15</span>, <span class="fl">0.05</span>, <span class="fl">0.8</span>)</span>
<span id="cb29-8"><a href="spatialInit.html#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="do">## rows are &quot;from&quot; cols are &quot;to&quot;</span></span>
<span id="cb29-9"><a href="spatialInit.html#cb29-9" aria-hidden="true" tabindex="-1"></a>plus_group_age <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb29-10"><a href="spatialInit.html#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="do">## partition</span></span>
<span id="cb29-11"><a href="spatialInit.html#cb29-11" aria-hidden="true" tabindex="-1"></a>N_age <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n_regions, <span class="at">ncol =</span> plus_group_age)</span>
<span id="cb29-12"><a href="spatialInit.html#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="do">## initialise with no movement initially</span></span>
<span id="cb29-13"><a href="spatialInit.html#cb29-13" aria-hidden="true" tabindex="-1"></a>N_age[<span class="dv">1</span>,] <span class="ot">=</span> R0 <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M <span class="sc">*</span> <span class="dv">1</span><span class="sc">:</span>plus_group_age) <span class="do">##</span></span>
<span id="cb29-14"><a href="spatialInit.html#cb29-14" aria-hidden="true" tabindex="-1"></a>N_age[<span class="dv">2</span>,] <span class="ot">=</span> R0 <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M <span class="sc">*</span> <span class="dv">1</span><span class="sc">:</span>plus_group_age) <span class="do">## </span></span>
<span id="cb29-15"><a href="spatialInit.html#cb29-15" aria-hidden="true" tabindex="-1"></a>N_age[<span class="dv">3</span>,] <span class="ot">=</span> R0 <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M <span class="sc">*</span> <span class="dv">1</span><span class="sc">:</span>plus_group_age) <span class="do">##</span></span>
<span id="cb29-16"><a href="spatialInit.html#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="spatialInit.html#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="do">## apply an annual cycle 10000 times to see what the &quot;initial conditions should be&quot;</span></span>
<span id="cb29-18"><a href="spatialInit.html#cb29-18" aria-hidden="true" tabindex="-1"></a>N_next_year_age <span class="ot">=</span> N_age</span>
<span id="cb29-19"><a href="spatialInit.html#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb29-20"><a href="spatialInit.html#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## recruitment</span></span>
<span id="cb29-21"><a href="spatialInit.html#cb29-21" aria-hidden="true" tabindex="-1"></a>  N_next_year_age[,<span class="dv">1</span>] <span class="ot">=</span> R0 <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M)</span>
<span id="cb29-22"><a href="spatialInit.html#cb29-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">## ageing and mortality</span></span>
<span id="cb29-23"><a href="spatialInit.html#cb29-23" aria-hidden="true" tabindex="-1"></a>  N_next_year_age[,<span class="dv">2</span><span class="sc">:</span>plus_group_age] <span class="ot">=</span> N_age[,<span class="dv">1</span><span class="sc">:</span>(plus_group_age <span class="sc">-</span> <span class="dv">1</span>)] <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M)</span>
<span id="cb29-24"><a href="spatialInit.html#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## plus group</span></span>
<span id="cb29-25"><a href="spatialInit.html#cb29-25" aria-hidden="true" tabindex="-1"></a>  N_next_year_age[,plus_group_age] <span class="ot">=</span> N_next_year_age[,plus_group_age] <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M) <span class="sc">+</span> N_age[,plus_group_age] <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M)</span>
<span id="cb29-26"><a href="spatialInit.html#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="do">## movement</span></span>
<span id="cb29-27"><a href="spatialInit.html#cb29-27" aria-hidden="true" tabindex="-1"></a>  N_age <span class="ot">=</span> <span class="fu">t</span>(movement_matrix) <span class="sc">%*%</span> N_next_year_age</span>
<span id="cb29-28"><a href="spatialInit.html#cb29-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-29"><a href="spatialInit.html#cb29-29" aria-hidden="true" tabindex="-1"></a>iterative_N_age <span class="ot">=</span> N_age</span>
<span id="cb29-30"><a href="spatialInit.html#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span>plus_group_age, N_age[<span class="dv">3</span>,], <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab=</span> <span class="st">&quot;Initial numbers&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,R0<span class="sc">*</span> <span class="fl">1.4</span>), <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb29-31"><a href="spatialInit.html#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1</span><span class="sc">:</span>plus_group_age, N_age[<span class="dv">2</span>,], <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb29-32"><a href="spatialInit.html#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1</span><span class="sc">:</span>plus_group_age, N_age[<span class="dv">1</span>,], <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb29-33"><a href="spatialInit.html#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topright&#39;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>), <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Region 3&quot;</span>, <span class="st">&quot;Region 2&quot;</span>, <span class="st">&quot;Region 1&quot;</span>), <span class="at">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/spatialcase-1.png" width="672" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="spatialInit.html#cb30-1" aria-hidden="true" tabindex="-1"></a>N_age <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> n_regions, <span class="at">ncol =</span> plus_group_age)</span>
<span id="cb30-2"><a href="spatialInit.html#cb30-2" aria-hidden="true" tabindex="-1"></a>update_N_age <span class="ot">=</span> N_age</span>
<span id="cb30-3"><a href="spatialInit.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(plus_group_age)) {</span>
<span id="cb30-4"><a href="spatialInit.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># recruitment</span></span>
<span id="cb30-5"><a href="spatialInit.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  update_N_age[,<span class="dv">1</span>] <span class="ot">=</span> R0 <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M)</span>
<span id="cb30-6"><a href="spatialInit.html#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ageing and mortality</span></span>
<span id="cb30-7"><a href="spatialInit.html#cb30-7" aria-hidden="true" tabindex="-1"></a>  update_N_age[,<span class="dv">2</span><span class="sc">:</span>plus_group_age] <span class="ot">=</span> N_age[,<span class="dv">1</span><span class="sc">:</span>(plus_group_age <span class="sc">-</span> <span class="dv">1</span>)] <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M)</span>
<span id="cb30-8"><a href="spatialInit.html#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plus group</span></span>
<span id="cb30-9"><a href="spatialInit.html#cb30-9" aria-hidden="true" tabindex="-1"></a>  update_N_age[,plus_group_age] <span class="ot">=</span> update_N_age[,plus_group_age] <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M) <span class="sc">+</span> N_age[,plus_group_age] <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M)</span>
<span id="cb30-10"><a href="spatialInit.html#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># movement</span></span>
<span id="cb30-11"><a href="spatialInit.html#cb30-11" aria-hidden="true" tabindex="-1"></a>  N_age <span class="ot">=</span> <span class="fu">t</span>(movement_matrix) <span class="sc">%*%</span> update_N_age</span>
<span id="cb30-12"><a href="spatialInit.html#cb30-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-13"><a href="spatialInit.html#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate one more annual cycle</span></span>
<span id="cb30-14"><a href="spatialInit.html#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co"># recruitment</span></span>
<span id="cb30-15"><a href="spatialInit.html#cb30-15" aria-hidden="true" tabindex="-1"></a>update_N_age[,<span class="dv">1</span>] <span class="ot">=</span> R0 <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M)</span>
<span id="cb30-16"><a href="spatialInit.html#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ageing and mortality</span></span>
<span id="cb30-17"><a href="spatialInit.html#cb30-17" aria-hidden="true" tabindex="-1"></a>update_N_age[,<span class="dv">2</span><span class="sc">:</span>plus_group_age] <span class="ot">=</span> N_age[,<span class="dv">1</span><span class="sc">:</span>(plus_group_age <span class="sc">-</span> <span class="dv">1</span>)] <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M)</span>
<span id="cb30-18"><a href="spatialInit.html#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co"># plus group</span></span>
<span id="cb30-19"><a href="spatialInit.html#cb30-19" aria-hidden="true" tabindex="-1"></a>update_N_age[,plus_group_age] <span class="ot">=</span> update_N_age[,plus_group_age] <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M) <span class="sc">+</span> N_age[,plus_group_age] <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>M)</span>
<span id="cb30-20"><a href="spatialInit.html#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co"># movement</span></span>
<span id="cb30-21"><a href="spatialInit.html#cb30-21" aria-hidden="true" tabindex="-1"></a>update_N_age <span class="ot">=</span> <span class="fu">t</span>(movement_matrix) <span class="sc">%*%</span> update_N_age</span>
<span id="cb30-22"><a href="spatialInit.html#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="do">## approximate!</span></span>
<span id="cb30-23"><a href="spatialInit.html#cb30-23" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> update_N_age[,plus_group_age] <span class="sc">/</span> N_age[,plus_group_age] <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb30-24"><a href="spatialInit.html#cb30-24" aria-hidden="true" tabindex="-1"></a>update_N_age[,plus_group_age] <span class="ot">=</span> N_age[,plus_group_age] <span class="sc">*</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> c)</span>
<span id="cb30-25"><a href="spatialInit.html#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="spatialInit.html#cb30-26" aria-hidden="true" tabindex="-1"></a>iterative_N_age[,plus_group_age]</span></code></pre></div>
<pre><code>## [1] 1758313 1217294 2705097</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="spatialInit.html#cb32-1" aria-hidden="true" tabindex="-1"></a>update_N_age[,plus_group_age]</span></code></pre></div>
<pre><code>## [1] 1758313 1217294 2705097</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="spatialInit.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span>plus_group_age, iterative_N_age[<span class="dv">3</span>,], <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab=</span> <span class="st">&quot;Initial numbers&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,R0<span class="sc">*</span> <span class="fl">1.4</span>), <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb34-2"><a href="spatialInit.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1</span><span class="sc">:</span>plus_group_age, update_N_age[<span class="dv">3</span>,], <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb34-3"><a href="spatialInit.html#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="spatialInit.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1</span><span class="sc">:</span>plus_group_age, iterative_N_age[<span class="dv">2</span>,], <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb34-5"><a href="spatialInit.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1</span><span class="sc">:</span>plus_group_age, update_N_age[<span class="dv">2</span>,], <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb34-6"><a href="spatialInit.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1</span><span class="sc">:</span>plus_group_age, iterative_N_age[<span class="dv">1</span>,], <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb34-7"><a href="spatialInit.html#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1</span><span class="sc">:</span>plus_group_age, update_N_age[<span class="dv">1</span>,], <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb34-8"><a href="spatialInit.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topright&#39;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Numerical&quot;</span>, <span class="st">&quot;Analytical&quot;</span>), <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/spatialcase_alt-1.png" width="672" /></p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="Fexplore.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spatialmodelInputs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://www.fisheries.noaa.gov/alaska/science-data/alaska-sablefish-fisheries-and-assessment/06-InitialisingTheSpatialModel.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"depth": 1
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
