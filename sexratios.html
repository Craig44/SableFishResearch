<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Exploring methods for sex ratios in age and length composition data | Alaskan sablefish research</title>
  <meta name="description" content="This Gitbook documents my post-doctoral research relating to Alaskan sablefish." />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Exploring methods for sex ratios in age and length composition data | Alaskan sablefish research" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This Gitbook documents my post-doctoral research relating to Alaskan sablefish." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Exploring methods for sex ratios in age and length composition data | Alaskan sablefish research" />
  
  <meta name="twitter:description" content="This Gitbook documents my post-doctoral research relating to Alaskan sablefish." />
  

<meta name="author" content="C.Marsh" />


<meta name="date" content="2022-11-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="modeldescription.html"/>
<link rel="next" href="Fexplore.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Sablefish Research</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="objectives.html"><a href="objectives.html"><i class="fa fa-check"></i><b>2</b> A list of objectives/milestones that we have set along the project life</a></li>
<li class="chapter" data-level="3" data-path="modeldescription.html"><a href="modeldescription.html"><i class="fa fa-check"></i><b>3</b> Current Stock assessment model</a>
<ul>
<li class="chapter" data-level="3.1" data-path="modeldescription.html"><a href="modeldescription.html#modelequations"><i class="fa fa-check"></i><b>3.1</b> Process equations</a>
<ul>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#initialisation-gleft.right"><i class="fa fa-check"></i>Initialisation (<span class="math inline">\(g\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#population-dynamics-fleft.right"><i class="fa fa-check"></i>Population dynamics (<span class="math inline">\(f\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#determining-selectivities-for-fisheries-and-surveys"><i class="fa fa-check"></i>Determining selectivities for fisheries and surveys</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="modeldescription.html"><a href="modeldescription.html#observationsection"><i class="fa fa-check"></i><b>3.2</b> Observation equations</a>
<ul>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#catch-at-age"><i class="fa fa-check"></i>Catch at age</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#relative-abundance-indices"><i class="fa fa-check"></i>Relative abundance indices</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#catch-at-length"><i class="fa fa-check"></i>Catch at length</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#observations-for-fisheries-and-surveys"><i class="fa fa-check"></i>Observations for fisheries and surveys</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="modeldescription.html"><a href="modeldescription.html#symbols"><i class="fa fa-check"></i><b>3.3</b> Symbol Notation</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#inference"><i class="fa fa-check"></i>Inference</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#todo"><i class="fa fa-check"></i>TODO</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sexratios.html"><a href="sexratios.html"><i class="fa fa-check"></i><b>4</b> Exploring methods for sex ratios in age and length composition data</a>
<ul>
<li class="chapter" data-level="" data-path="sexratios.html"><a href="sexratios.html#simulation-testing"><i class="fa fa-check"></i>Simulation testing</a></li>
<li class="chapter" data-level="" data-path="sexratios.html"><a href="sexratios.html#other-things-to-consider"><i class="fa fa-check"></i>Other things to consider</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="Fexplore.html"><a href="Fexplore.html"><i class="fa fa-check"></i><b>5</b> Exploring alternative fishing mortality parameterisations (F)</a>
<ul>
<li class="chapter" data-level="" data-path="Fexplore.html"><a href="Fexplore.html#set-up-a-simulation"><i class="fa fa-check"></i>Set up a simulation</a></li>
<li class="chapter" data-level="" data-path="Fexplore.html"><a href="Fexplore.html#other-things-to-consider-1"><i class="fa fa-check"></i>Other things to consider</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tagdata.html"><a href="tagdata.html"><i class="fa fa-check"></i><b>6</b> Tagging data and studies</a>
<ul>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#integration-in-age-structured-models"><i class="fa fa-check"></i>Integration in age-structured models</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#growth-estimation-using-the-laslettevesonpolacheck-lep"><i class="fa fa-check"></i>Growth estimation using the Laslett–Eveson–Polacheck (LEP)</a>
<ul>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#age-at-length-growth-model"><i class="fa fa-check"></i>Age-at-length growth model</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#tag-recapture-growth-data"><i class="fa fa-check"></i>Tag recapture growth data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#simulation-test-the-lep-method"><i class="fa fa-check"></i>Simulation test the “LEP” method</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#next-steps"><i class="fa fa-check"></i>Next steps</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="refpoints.html"><a href="refpoints.html"><i class="fa fa-check"></i><b>7</b> Review/summarise reference points</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://www.fisheries.noaa.gov/alaska/science-data/alaska-sablefish-fisheries-and-assessment" target="blank">NOAA Website</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Alaskan sablefish research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sexratios" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Exploring methods for sex ratios in age and length composition data<a href="sexratios.html#sexratios" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>One of the needed improvements is dealing with sex ratios in the compositional data. Currently it is difficult to see how there is any information on sex ratio in the Alaskan sablefish stock assessment given how the observations are structured (Chapter <a href="modeldescription.html#modeldescription">3</a>) (Caveat is users can provide an observed sex ratio for observations etc which is similar to the approach in <span class="citation">Ward et al. (<a href="#ref-ward2019assessing" role="doc-biblioref">2019</a>)</span>). I am aware of two approaches for supplying observations that in theory should provide information on sex ratio. The first (approach 1) was taken from Casal2 <span class="citation">(<a href="#ref-doonan2016casal2" role="doc-biblioref">Doonan et al. 2016</a>)</span>. This treats sexed composition data for a year as a single proportion i.e., proportions across all ages and sexes sum to one for each year,</p>
<p><span class="math display">\[
\boldsymbol{P}^k_{y} = \frac{(C^k_{a,y,1},C^k_{a,y,2})}{\sum_a \sum_s C^k_{a,y,s}}, \quad \sum \boldsymbol{P}^k_{y} = 1
\]</span>
where, <span class="math inline">\(C^k_{a,y,1}\)</span> is the catch at age (numbers) for males in year <span class="math inline">\(y\)</span>, age <span class="math inline">\(a\)</span> and survey <span class="math inline">\(k\)</span>. <span class="math inline">\(\boldsymbol{P}^k_{y}\)</span> is a proportion vector that sums to one that covers both sexes and corresponding ages. The likelihood contribution for this approach follows<br />
<span class="math display">\[
\boldsymbol{P}^k_{y} \sim Multinomial(\mathbb{E}[\boldsymbol{P}^k_{y}], N^{eff, k}_{y}) \ .
\]</span>
where, <span class="math inline">\(N^{eff, k}_{y}\)</span> is the effective sample size for this survey and year.</p>
<p>The second approach (approach 2) is to treat composition for each sex seperately that is proportions at age or length for a sex will sum to one, but also provide a specific sex ratio observation over all ages or lengths as done in the New Zealand rock lobster stock assessment <span class="citation">(<a href="#ref-webber2021rapid" role="doc-biblioref">Webber, Rudd, and Starr 2021</a>)</span>.</p>
<p><span class="math display">\[
R^k_{y,s} = \frac{\sum_a \{C^k}_{a,y,s}}{\sum_a \sum_s \{C^k}_{a,y,s}}, \quad  \sum_s R^k_{y,s} = 1
\]</span>
and,
<span class="math display">\[
P^k_{a, y,s} = \frac{\{C^k}_{a,y,s}}{\sum_a \{C^k}_{a,y,s}}, \quad  \sum_a P^k_{a, y,s} = 1 \ .
\]</span>
The likelihood assumptions for this model are,
<span class="math display">\[
R^k_{y,s} \sim Binomial(\mathbb{E}[R^k_{y,s}], \sum_s N^{eff, k}_{y,s})
\]</span>
and,
<span class="math display">\[
\boldsymbol{P}^k_{y,s} \sim Multinomial(\mathbb{E}[\boldsymbol{P}^k_{a, y,s}], N^{eff, k}_{y,s}) \ .
\]</span>
where, <span class="math inline">\(N^{eff, k}_{y,s}\)</span> is the effective sample size.</p>
<div id="simulation-testing" class="section level2 unnumbered hasAnchor">
<h2>Simulation testing<a href="sexratios.html#simulation-testing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A simple simulation experiment was conducted to explore the benefits of each approach. There were two OM scenarios that we wanted to explore, the first was that the true population had a 50:50 sex ratio and the observations had skewed sex ratios due to the selectivity i.e., availability to the survey fishery. Second the selectivity was constant for both sexes but the sex ratio was skewed at recruitment.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="sexratios.html#cb2-1" aria-hidden="true" tabindex="-1"></a>bio_params <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb2-2"><a href="sexratios.html#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ages =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb2-3"><a href="sexratios.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">L_inf_m =</span> <span class="dv">58</span>,</span>
<span id="cb2-4"><a href="sexratios.html#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">K_m =</span> <span class="fl">0.133</span>,</span>
<span id="cb2-5"><a href="sexratios.html#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">t0_m =</span> <span class="dv">0</span>,</span>
<span id="cb2-6"><a href="sexratios.html#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">L_inf_f =</span> <span class="dv">62</span>,</span>
<span id="cb2-7"><a href="sexratios.html#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">K_f =</span> <span class="fl">0.143</span>,</span>
<span id="cb2-8"><a href="sexratios.html#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">t0_f =</span> <span class="dv">0</span>,</span>
<span id="cb2-9"><a href="sexratios.html#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">M =</span> <span class="fl">0.15</span>,</span>
<span id="cb2-10"><a href="sexratios.html#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">a_m =</span> <span class="fl">2.18e-9</span>, <span class="do">## tonnes</span></span>
<span id="cb2-11"><a href="sexratios.html#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">b_m =</span> <span class="fl">3.2</span>,</span>
<span id="cb2-12"><a href="sexratios.html#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">a_f =</span> <span class="fl">2.08e-9</span>, <span class="do">## tonnes</span></span>
<span id="cb2-13"><a href="sexratios.html#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">b_f =</span> <span class="fl">3.3</span>,</span>
<span id="cb2-14"><a href="sexratios.html#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">m_a50 =</span> <span class="fl">2.3</span>,</span>
<span id="cb2-15"><a href="sexratios.html#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">m_ato95 =</span> <span class="fl">1.2</span>,</span>
<span id="cb2-16"><a href="sexratios.html#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma =</span> <span class="fl">0.6</span>,</span>
<span id="cb2-17"><a href="sexratios.html#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fl">0.85</span>,</span>
<span id="cb2-18"><a href="sexratios.html#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma_r =</span> <span class="fl">0.6</span>,</span>
<span id="cb2-19"><a href="sexratios.html#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">R0 =</span> <span class="dv">8234132</span>,</span>
<span id="cb2-20"><a href="sexratios.html#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">plus_group =</span> <span class="dv">1</span> <span class="co"># 0 = No, 1 = Yes</span></span>
<span id="cb2-21"><a href="sexratios.html#cb2-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-22"><a href="sexratios.html#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="sexratios.html#cb2-23" aria-hidden="true" tabindex="-1"></a>other_params <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb2-24"><a href="sexratios.html#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">s_a50_m =</span> <span class="fl">3.6</span>,</span>
<span id="cb2-25"><a href="sexratios.html#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">s_ato95_m =</span> <span class="dv">2</span>,</span>
<span id="cb2-26"><a href="sexratios.html#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">s_a50_f =</span> <span class="fl">4.6</span>,</span>
<span id="cb2-27"><a href="sexratios.html#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">s_ato95_f =</span> <span class="fl">1.4</span>,</span>
<span id="cb2-28"><a href="sexratios.html#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">s_q =</span> <span class="fl">0.2</span>,</span>
<span id="cb2-29"><a href="sexratios.html#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">s_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb2-30"><a href="sexratios.html#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">f_a50_m =</span> <span class="fl">4.2</span>,</span>
<span id="cb2-31"><a href="sexratios.html#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">f_ato95_m =</span> <span class="fl">1.17</span>,</span>
<span id="cb2-32"><a href="sexratios.html#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">f_a50_f =</span> <span class="fl">4.7</span>,</span>
<span id="cb2-33"><a href="sexratios.html#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">f_ato95_f =</span> <span class="fl">1.76</span>,</span>
<span id="cb2-34"><a href="sexratios.html#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">f_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb2-35"><a href="sexratios.html#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">ssb_prop_Z =</span> <span class="fl">0.5</span>,</span>
<span id="cb2-36"><a href="sexratios.html#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey_prop_Z =</span> <span class="fl">0.5</span>,</span>
<span id="cb2-37"><a href="sexratios.html#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey_age_error =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.4</span>),  <span class="do">## sd, rho (ignored if iid)</span></span>
<span id="cb2-38"><a href="sexratios.html#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">fishery_age_error =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.4</span>),  <span class="do">## sd, rho (ignored if iid)</span></span>
<span id="cb2-39"><a href="sexratios.html#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey_bio_cv =</span> <span class="fu">c</span>(<span class="fl">0.1</span>)</span>
<span id="cb2-40"><a href="sexratios.html#cb2-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-41"><a href="sexratios.html#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="sexratios.html#cb2-42" aria-hidden="true" tabindex="-1"></a>ages <span class="ot">=</span> bio_params<span class="sc">$</span>ages</span>
<span id="cb2-43"><a href="sexratios.html#cb2-43" aria-hidden="true" tabindex="-1"></a>max_age <span class="ot">=</span> <span class="fu">max</span>(bio_params<span class="sc">$</span>ages)</span>
<span id="cb2-44"><a href="sexratios.html#cb2-44" aria-hidden="true" tabindex="-1"></a>n_years <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb2-45"><a href="sexratios.html#cb2-45" aria-hidden="true" tabindex="-1"></a>years <span class="ot">=</span> (<span class="dv">2020</span> <span class="sc">-</span> n_years <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">2020</span></span>
<span id="cb2-46"><a href="sexratios.html#cb2-46" aria-hidden="true" tabindex="-1"></a>n_ages <span class="ot">=</span> <span class="fu">length</span>(ages)</span>
<span id="cb2-47"><a href="sexratios.html#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="do">## annual fishing mortality</span></span>
<span id="cb2-48"><a href="sexratios.html#cb2-48" aria-hidden="true" tabindex="-1"></a>start_F <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rlnorm</span>(<span class="dv">10</span>, <span class="fu">log</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.02</span>, <span class="at">to =</span> <span class="fl">0.1</span>, <span class="at">length =</span> <span class="dv">10</span>)), <span class="fl">0.1</span>), <span class="fu">rlnorm</span>(<span class="dv">10</span>, <span class="fu">log</span>(<span class="fl">0.08</span>), <span class="fl">0.1</span>), <span class="fu">rlnorm</span>(<span class="dv">10</span>, <span class="fu">log</span>(<span class="fl">0.07</span>), <span class="fl">0.1</span>))</span>
<span id="cb2-49"><a href="sexratios.html#cb2-49" aria-hidden="true" tabindex="-1"></a>recruit_devs <span class="ot">=</span> <span class="fu">log</span>(<span class="fu">rlnorm</span>(n_years, <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> bio_params<span class="sc">$</span>sigma_r <span class="sc">*</span> bio_params<span class="sc">$</span>sigma_r, bio_params<span class="sc">$</span>sigma_r))</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="sexratios.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb3-2"><a href="sexratios.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">### Build TMB OM with Multinomial</span></span>
<span id="cb3-3"><a href="sexratios.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb3-4"><a href="sexratios.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#dyn.unload(dynlib(file.path(DIR$book,&quot;TMB&quot;,&quot;SexDisaggregatedAgeStructuredModel&quot;)))</span></span>
<span id="cb3-5"><a href="sexratios.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">compile</span>(<span class="fu">file.path</span>(<span class="st">&quot;TMB&quot;</span>,<span class="st">&quot;SexDisaggregatedAgeStructuredModel.cpp&quot;</span>), <span class="at">flags =</span> <span class="st">&quot;-Wignored-attributes -O3&quot;</span>,<span class="at">DLLFLAGS=</span><span class="st">&quot;&quot;</span>);</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="sexratios.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dyn.load</span>(<span class="fu">dynlib</span>(<span class="fu">file.path</span>(<span class="st">&quot;TMB&quot;</span>,<span class="st">&quot;SexDisaggregatedAgeStructuredModel&quot;</span>)))</span>
<span id="cb5-2"><a href="sexratios.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="do">## tolerance form model convergence, all gradients need to be less than this.</span></span>
<span id="cb5-3"><a href="sexratios.html#cb5-3" aria-hidden="true" tabindex="-1"></a>grad_tol <span class="ot">=</span> <span class="fl">0.001</span></span>
<span id="cb5-4"><a href="sexratios.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># these parameters we are not estimating.</span></span>
<span id="cb5-5"><a href="sexratios.html#cb5-5" aria-hidden="true" tabindex="-1"></a>na_map <span class="ot">=</span> <span class="fu">fix_pars</span>(<span class="at">par_list =</span> true_pars, <span class="at">pars_to_exclude =</span> <span class="fu">c</span>(<span class="st">&quot;logit_survey_alpha_f&quot;</span>,<span class="st">&quot;logit_f_alpha_f&quot;</span>,<span class="st">&quot;ln_catch_sd&quot;</span>,<span class="st">&quot;ln_extra_survey_cv&quot;</span>,<span class="st">&quot;ln_sigma_r&quot;</span>, <span class="st">&quot;logit_proportion_male&quot;</span>))</span>
<span id="cb5-6"><a href="sexratios.html#cb5-6" aria-hidden="true" tabindex="-1"></a>ASM_obj <span class="ot">&lt;-</span> <span class="fu">MakeADFun</span>(TMB_data, true_pars, <span class="at">DLL=</span> <span class="st">&quot;SexDisaggregatedAgeStructuredModel&quot;</span>, <span class="at">map =</span> na_map,<span class="at">checkParameterOrder=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Constructing atomic D_lgamma</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="sexratios.html#cb7-1" aria-hidden="true" tabindex="-1"></a>TMB_data_alt <span class="ot">=</span> TMB_data</span>
<span id="cb7-2"><a href="sexratios.html#cb7-2" aria-hidden="true" tabindex="-1"></a>TMB_data_alt<span class="sc">$</span>survey_AF_type <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb7-3"><a href="sexratios.html#cb7-3" aria-hidden="true" tabindex="-1"></a>TMB_data_alt<span class="sc">$</span>fishery_AF_type <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb7-4"><a href="sexratios.html#cb7-4" aria-hidden="true" tabindex="-1"></a>ASM_obj_alt_sex <span class="ot">&lt;-</span> <span class="fu">MakeADFun</span>(TMB_data_alt, true_pars, <span class="at">DLL=</span> <span class="st">&quot;SexDisaggregatedAgeStructuredModel&quot;</span>, <span class="at">map =</span> na_map,<span class="at">checkParameterOrder=</span><span class="cn">FALSE</span>)</span>
<span id="cb7-5"><a href="sexratios.html#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="sexratios.html#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb7-7"><a href="sexratios.html#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">### Generate predictions from both methods to compare</span></span>
<span id="cb7-8"><a href="sexratios.html#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="do">##################################</span></span>
<span id="cb7-9"><a href="sexratios.html#cb7-9" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">=</span> ASM_obj<span class="sc">$</span><span class="fu">simulate</span>(<span class="at">complete =</span> T)</span>
<span id="cb7-10"><a href="sexratios.html#cb7-10" aria-hidden="true" tabindex="-1"></a>sim_data_alt <span class="ot">=</span> ASM_obj_alt_sex<span class="sc">$</span><span class="fu">simulate</span>(<span class="at">complete =</span> T)</span>
<span id="cb7-11"><a href="sexratios.html#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="sexratios.html#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb7-13"><a href="sexratios.html#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(survey_ages, sim_data_alt<span class="sc">$</span>survey_comp_fitted[<span class="dv">1</span><span class="sc">:</span>n_ages,<span class="dv">9</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">ylab =</span> <span class="st">&quot;Survey predicted values&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Approach 1&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb7-14"><a href="sexratios.html#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(survey_ages, sim_data_alt<span class="sc">$</span>survey_comp_fitted[(n_ages <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(n_ages<span class="sc">*</span><span class="dv">2</span>),<span class="dv">9</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb7-15"><a href="sexratios.html#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(survey_ages, sim_data<span class="sc">$</span>survey_comp_fitted[<span class="dv">1</span><span class="sc">:</span>n_ages,<span class="dv">9</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Approach 2&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.2</span>))</span>
<span id="cb7-16"><a href="sexratios.html#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(survey_ages, sim_data<span class="sc">$</span>survey_comp_fitted[(n_ages <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(n_ages<span class="sc">*</span><span class="dv">2</span>),<span class="dv">9</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb7-17"><a href="sexratios.html#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="sexratios.html#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fishery_ages, sim_data_alt<span class="sc">$</span>fishery_comp_fitted[<span class="dv">1</span><span class="sc">:</span>n_ages,<span class="dv">9</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">ylab =</span> <span class="st">&quot;Fishery predicted values&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.3</span>))</span>
<span id="cb7-19"><a href="sexratios.html#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fishery_ages, sim_data_alt<span class="sc">$</span>fishery_comp_fitted[(n_ages <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(n_ages<span class="sc">*</span><span class="dv">2</span>),<span class="dv">9</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb7-20"><a href="sexratios.html#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="sexratios.html#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fishery_ages, sim_data<span class="sc">$</span>fishery_comp_fitted[<span class="dv">1</span><span class="sc">:</span>n_ages,<span class="dv">9</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.3</span>))</span>
<span id="cb7-22"><a href="sexratios.html#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fishery_ages, sim_data<span class="sc">$</span>fishery_comp_fitted[(n_ages <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(n_ages<span class="sc">*</span><span class="dv">2</span>),<span class="dv">9</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb7-23"><a href="sexratios.html#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&#39;topright&#39;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Feale&quot;</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/compile_sex_plot-1.png" width="672" /></p>
</div>
<div id="other-things-to-consider" class="section level2 unnumbered hasAnchor">
<h2>Other things to consider<a href="sexratios.html#other-things-to-consider" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>LF observations with sexual dimorphism in growth. A possible reason LF’s could be influencing assessment output is due to mis-specified growth ala</li>
</ul>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-doonan2016casal2" class="csl-entry">
Doonan, Ian, Kath Large, Alistair Dunn, Scott Rasmussen, Craig Marsh, and Sophie Mormede. 2016. <span>“Casal2: New Zealand’s Integrated Population Modelling Tool.”</span> <em>Fisheries Research</em> 183: 498–505.
</div>
<div id="ref-ward2019assessing" class="csl-entry">
Ward, Eric J, Helena Delgado-Nordmann, Richard E Brenner, Anne H Beaudreau, Steven D Moffitt, and Andrew O Shelton. 2019. <span>“Assessing Long-Term Changes in Sex Ratios of Pacific Herring in Prince William Sound, Alaska.”</span> <em>Fisheries Research</em> 211: 300–308.
</div>
<div id="ref-webber2021rapid" class="csl-entry">
Webber, DN, MB Rudd, and PJ Starr. 2021. <span>“Rapid Updates for New Zealand Rock Lobster (Jasus Edwardsii) Stocks in 2020.”</span> <em>New Zealand Fisheries Assessment Report</em> 61: 34.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="modeldescription.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Fexplore.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://www.fisheries.noaa.gov/alaska/science-data/alaska-sablefish-fisheries-and-assessment/03-DealWithSexRatios.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
