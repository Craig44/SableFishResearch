<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Current Alaskan sablefish stock assessment model | Alaskan sablefish research</title>
  <meta name="description" content="This Gitbook documents my post-doctoral research relating to Alaskan sablefish." />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Current Alaskan sablefish stock assessment model | Alaskan sablefish research" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This Gitbook documents my post-doctoral research relating to Alaskan sablefish." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Current Alaskan sablefish stock assessment model | Alaskan sablefish research" />
  
  <meta name="twitter:description" content="This Gitbook documents my post-doctoral research relating to Alaskan sablefish." />
  

<meta name="author" content="C.Marsh" />


<meta name="date" content="2022-11-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="objectives.html"/>
<link rel="next" href="spatialmodeldescription.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Sablefish Research</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#future-things-to-consider"><i class="fa fa-check"></i>Future things to consider</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#chapter-overview"><i class="fa fa-check"></i>chapter overview</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="objectives.html"><a href="objectives.html"><i class="fa fa-check"></i><b>2</b> A list of objectives/milestones that we have set along the project life</a></li>
<li class="chapter" data-level="3" data-path="modeldescription.html"><a href="modeldescription.html"><i class="fa fa-check"></i><b>3</b> Current Alaskan sablefish stock assessment model</a>
<ul>
<li class="chapter" data-level="3.1" data-path="modeldescription.html"><a href="modeldescription.html#modelequations"><i class="fa fa-check"></i><b>3.1</b> Process equations</a>
<ul>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#initialisation-gleft.right"><i class="fa fa-check"></i>Initialisation (<span class="math inline">\(g\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#population-dynamics-fleft.right"><i class="fa fa-check"></i>Population dynamics (<span class="math inline">\(f\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#determining-selectivities-for-fisheries-and-surveys"><i class="fa fa-check"></i>Determining selectivities for fisheries and surveys</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="modeldescription.html"><a href="modeldescription.html#observationsection"><i class="fa fa-check"></i><b>3.2</b> Observation equations</a>
<ul>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#catch-at-age"><i class="fa fa-check"></i>Catch at age</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#relative-abundance-indices"><i class="fa fa-check"></i>Relative abundance indices</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#catch-at-length"><i class="fa fa-check"></i>Catch at length</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#observations-for-fisheries-and-surveys"><i class="fa fa-check"></i>Observations for fisheries and surveys</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="modeldescription.html"><a href="modeldescription.html#symbols"><i class="fa fa-check"></i><b>3.3</b> Symbol Notation</a>
<ul>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#inference"><i class="fa fa-check"></i>Inference</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#todo"><i class="fa fa-check"></i>TODO</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html"><i class="fa fa-check"></i><b>4</b> Spatial stock assessment model for Alaskan sablefish</a>
<ul>
<li class="chapter" data-level="4.1" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#spatialmodelequations"><i class="fa fa-check"></i><b>4.1</b> Process equations</a>
<ul>
<li class="chapter" data-level="" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#initialisation-gleft.right-1"><i class="fa fa-check"></i>Initialisation (<span class="math inline">\(g\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#population-dynamics-fleft.right-1"><i class="fa fa-check"></i>Population dynamics (<span class="math inline">\(f\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#to-do"><i class="fa fa-check"></i>To DO</a></li>
<li class="chapter" data-level="" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#appendix"><i class="fa fa-check"></i>Appendix</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sexratios.html"><a href="sexratios.html"><i class="fa fa-check"></i><b>5</b> Sex ratios in age and length composition data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sexratios.html"><a href="sexratios.html#sexSimulation"><i class="fa fa-check"></i><b>5.1</b> A simple simulation</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="sexratios.html"><a href="sexratios.html#results"><i class="fa fa-check"></i><b>5.1.1</b> Results</a></li>
<li class="chapter" data-level="" data-path="sexratios.html"><a href="sexratios.html#future-research-that-was-not-considered-in-this-simple-simulation"><i class="fa fa-check"></i>Future research that was not considered in this simple simulation</a></li>
<li class="chapter" data-level="5.1.2" data-path="sexratios.html"><a href="sexratios.html#scenario-1"><i class="fa fa-check"></i><b>5.1.2</b> Scenario 1</a></li>
<li class="chapter" data-level="5.1.3" data-path="sexratios.html"><a href="sexratios.html#scenario-2"><i class="fa fa-check"></i><b>5.1.3</b> Scenario 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Fexplore.html"><a href="Fexplore.html"><i class="fa fa-check"></i><b>6</b> Fishing mortality approaches</a>
<ul>
<li class="chapter" data-level="" data-path="Fexplore.html"><a href="Fexplore.html#set-up-a-simulation"><i class="fa fa-check"></i>Set up a simulation</a></li>
<li class="chapter" data-level="" data-path="Fexplore.html"><a href="Fexplore.html#appendix---hybrid-approach"><i class="fa fa-check"></i>Appendix - Hybrid approach</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="spatialInit.html"><a href="spatialInit.html"><i class="fa fa-check"></i><b>7</b> Initialising the plus group in spatial models</a></li>
<li class="chapter" data-level="8" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html"><i class="fa fa-check"></i><b>8</b> Spatial model inputs</a>
<ul>
<li class="chapter" data-level="8.1" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#surveyData"><i class="fa fa-check"></i><b>8.1</b> Survey Abundance data</a></li>
<li class="chapter" data-level="8.2" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#AFs"><i class="fa fa-check"></i><b>8.2</b> Age-frequency</a>
<ul>
<li class="chapter" data-level="" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#direct-ageing-estimator"><i class="fa fa-check"></i>Direct Ageing estimator</a></li>
<li class="chapter" data-level="" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#length-frequency"><i class="fa fa-check"></i>Length-frequency</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#ObserverData"><i class="fa fa-check"></i><b>8.3</b> Observer data</a></li>
<li class="chapter" data-level="8.4" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#CatchData"><i class="fa fa-check"></i><b>8.4</b> Catch data</a></li>
<li class="chapter" data-level="" data-path="spatialmodelInputs.html"><a href="spatialmodelInputs.html#appendix-1"><i class="fa fa-check"></i>Appendix</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tagdata.html"><a href="tagdata.html"><i class="fa fa-check"></i><b>9</b> Tagging data and studies</a>
<ul>
<li class="chapter" data-level="9.1" data-path="tagdata.html"><a href="tagdata.html#integrating-tagging-observations-in-spatial-age-structured-models"><i class="fa fa-check"></i><b>9.1</b> Integrating tagging observations in spatial age-structured models</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#tagging-things-to-consider-with-relevant-references"><i class="fa fa-check"></i>Tagging things to consider with relevant references</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#releasing-tags"><i class="fa fa-check"></i>Releasing tags</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#tag-recovery-observations"><i class="fa fa-check"></i>Tag recovery observations</a></li>
<li class="chapter" data-level="9.2" data-path="tagdata.html"><a href="tagdata.html#growth-estimation-using-the-laslettevesonpolacheck-lep-method"><i class="fa fa-check"></i><b>9.2</b> Growth estimation using the Laslett–Eveson–Polacheck (LEP) method</a>
<ul>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#age-at-length-growth-model"><i class="fa fa-check"></i>Age-at-length growth model</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#tag-recapture-growth-data"><i class="fa fa-check"></i>Tag recapture growth data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#simulation-test-the-lep-method"><i class="fa fa-check"></i>Simulation test the “LEP” method</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#next-steps"><i class="fa fa-check"></i>Next steps</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="refpoints.html"><a href="refpoints.html"><i class="fa fa-check"></i><b>10</b> Review/summarise reference points</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://www.fisheries.noaa.gov/alaska/science-data/alaska-sablefish-fisheries-and-assessment" target="blank">NOAA Website</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Alaskan sablefish research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modeldescription" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Current Alaskan sablefish stock assessment model<a href="modeldescription.html#modeldescription" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The latest published stock assessment <span class="citation">(<a href="#ref-goethel2021assessment" role="doc-biblioref">Goethel et al. 2021</a>)</span> is a single area model (Chapter <a href="modeldescription.html#modeldescription">3</a>). This chapter intends to extend this model by allowing it to be spatially disaggregated.</p>
<p>disaggregated integrated age-structured model. Let <span class="math inline">\(\boldsymbol{N_{y,s}}\)</span> denote a vector of ages in year <span class="math inline">\(y\)</span> for sex <span class="math inline">\(s\)</span> (the partition) i.e., <span class="math inline">\(\boldsymbol{N_{y,s}} = (N_{1,y,s}, N_{2,y,s}, \dots, N_{a_+,y,s})^T\)</span>. The general process model is sequential and follows the general Equation <a href="modeldescription.html#eq:processmodel">(3.1)</a>,</p>
<p><span class="math display" id="eq:processmodel">\[\begin{equation}
  \boldsymbol{N_{y,s}} =
  \begin{cases}
  g\left(\boldsymbol{\theta}\right), &amp; y = 1959 \text{ Initial model year}\\
  f\left(\boldsymbol{N_{y-1,s}}|\boldsymbol{\theta}\right), &amp; y &gt; 1959 \\
  \end{cases}
  \tag{3.1}
\end{equation}\]</span>
where, <span class="math inline">\(g(.)\)</span> is the function describing initial conditions for the partition and <span class="math inline">\(f(.)\)</span> is the function that applies populations dyanmics each year i.e., birth, death, growth and migration. See Section <a href="modeldescription.html#symbols">3.3</a> &amp; <a href="modeldescription.html#modelequations">3.1</a> for a detailed description of <span class="math inline">\(g(.)\)</span> and <span class="math inline">\(f(.)\)</span> and <span class="math inline">\(\boldsymbol{\theta}\)</span> is the set of estimable (not all are estimated) parameters.</p>
<p>Maximum Likelihood Estimates (MLE) for estimated parameters <span class="math inline">\(\widehat{\boldsymbol{\theta}}_{MLE}\)</span> are evaluated,
<span class="math display" id="eq:observationmodel">\[\begin{equation}
    \widehat{\boldsymbol{\theta}}_{MLE} = \underset{\boldsymbol{\theta}}{\arg\max} \left( L\left(\boldsymbol{\theta} | \boldsymbol{y^{obs}}\right) \right)
      \tag{3.2}
\end{equation}\]</span>
where, <span class="math inline">\(\boldsymbol{y^{obs}}\)</span> is a set of observations and <span class="math inline">\(L\left( . \right)\)</span> is an objective function that is made up of priors/penalties and log-likelihood. See Section <a href="modeldescription.html#observationsection">3.2</a></p>
<div id="modelequations" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Process equations<a href="modeldescription.html#modelequations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="initialisation-gleft.right" class="section level3 unnumbered hasAnchor">
<h3>Initialisation (<span class="math inline">\(g\left(.\right)\)</span>)<a href="modeldescription.html#initialisation-gleft.right" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display">\[\begin{align*}
N_{a,1,s} =
\begin{cases}
R_1, &amp; a = a_1\\
\exp\bigg( \mu_r + \tau_{a_1 - a + 1}\bigg) \exp-\bigg( a - a_1\bigg) \bigg( M + F_{hist} * \mu_{LL} * S^{LL}_{a,1}\bigg), &amp; a_0 &lt; a &lt; a_+\\
\exp( \mu_r) \exp-( a - 1) ( M + F_{hist} * \mu_{LL} * S^{LL}_{a - 1,1})(1 - \exp( M + F_{hist} * \mu_{LL} * S^{LL}_{a - 1,1}))^{-1}, &amp;  a = a_+
\end{cases}
\end{align*}\]</span></p>
</div>
<div id="population-dynamics-fleft.right" class="section level3 unnumbered hasAnchor">
<h3>Population dynamics (<span class="math inline">\(f\left(.\right)\)</span>)<a href="modeldescription.html#population-dynamics-fleft.right" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The assessment assumes a closed population that is only effected by mortality (natural and fishing), recruitment and growth. Mortality is applied assuming</p>
<p><span class="math display">\[
Z_{a,y,s} = M + \sum_g F^g_{y} S^g_{a,y,s}
\]</span>
where, <span class="math inline">\(S^g_{a,y,s}\)</span> is the fishery selectivity and <span class="math inline">\(F^g_{y}\)</span> is the annual estimated fishing mortality. The annual cycle follows,</p>
<p><span class="math display">\[\begin{align*}
N_{a,y,s} =
\begin{cases}
p^s_{y} R_y, &amp; a = a_1\\
N_{a - 1,y - 1,s} \times
\exp\bigg( -Z_{a - 1,y - 1,s} \bigg), &amp; a_0 &lt; a &lt; a_+\\
\exp\bigg( -Z_{a - 1,y - 1,s} \bigg) + \exp\bigg( -Z_{a,y - 1,s} \bigg), &amp;  a = a_+
\end{cases}
\end{align*}\]</span>
where,
<span class="math display">\[
R_y = \exp\{\mu_r + \tau_y + 0.5\sigma_R^2\}
\]</span></p>
</div>
<div id="determining-selectivities-for-fisheries-and-surveys" class="section level3 unnumbered hasAnchor">
<h3>Determining selectivities for fisheries and surveys<a href="modeldescription.html#determining-selectivities-for-fisheries-and-surveys" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The ADMB model has a hard coded number of selectivities. Some of them relate to changes in the fishery and so represent time-varying blocks. We want to spell these out and simplify for the TMB model. There are nine selectivities labelled <code>fish1</code>, <code>fish2</code>, <code>fish3</code>, <code>fish4</code>, <code>fish5</code>, <code>srv1</code>, <code>srv2</code> and <code>srv10</code>.</p>
<table>
<colgroup>
<col width="27%" />
<col width="72%" />
</colgroup>
<thead>
<tr class="header">
<th>label</th>
<th>Selectivity description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>fish1</code></td>
<td>Longline selectivity from 1960-1994</td>
</tr>
<tr class="even">
<td><code>fish2</code></td>
<td>Not sure if this is used, maybe this is used for <code>srv6</code>?</td>
</tr>
<tr class="odd">
<td><code>fish3</code></td>
<td>Trawl selectivity from 1960 - <span class="math inline">\(T\)</span></td>
</tr>
<tr class="even">
<td><code>fish4</code></td>
<td>Longline selectivity from 1995 -<span class="math inline">\(\ IFQ_y\)</span> (<span class="math inline">\(IFQ_y\)</span> can = <span class="math inline">\(T\)</span></td>
</tr>
<tr class="odd">
<td><code>fish5</code></td>
<td>Longline selectivity from <span class="math inline">\(IFQ_y \ - \ T\)</span> if there is post IFQ block</td>
</tr>
<tr class="even">
<td><code>srv1</code></td>
<td>Domestic Longline survey selectivity</td>
</tr>
<tr class="odd">
<td><code>srv2</code></td>
<td>Japanese Longline survey selectivity</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="observationsection" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Observation equations<a href="modeldescription.html#observationsection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Three are three observational types in the current Sablefish stock assessment
- Relative abundance indices
- Age composition (aggregated over sex)
- Length composition (disaggregated by sex)</p>
<p>These three observation types come from both fishery dependent i.e., observer programs and CPUE and fishery independent i.e., research surveys.</p>
<div id="catch-at-age" class="section level3 unnumbered hasAnchor">
<h3>Catch at age<a href="modeldescription.html#catch-at-age" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Fishery dependent catch at age observations for gear type <span class="math inline">\(g\)</span> denoted by <span class="math inline">\(\boldsymbol{C^g}_{a,y,s}\)</span> are calculated as follows</p>
<p><span class="math display" id="eq:catchatage">\[\begin{equation}
  \boldsymbol{C^g}_{a,y,s} = \frac{F^g_{a,y,s}}{Z_{a,y,s}}   N_{a,y,s} \left(1 - S_{a,y,s} \right)
  \tag{3.3}
\end{equation}\]</span>
Currently all age observations are sex aggregated which means the model expected values before applying ageing error is
<span class="math display">\[
  \boldsymbol{C^g}_{a,y} = 0.5 \sum_s \frac{\boldsymbol{C^g}_{a,y,s}}{\sum_a\boldsymbol{C^g}_{a,y,s}}
\]</span>
why the 0.5? should be omitted going forward. Ageing error is then incorporated and the values are normalized so that they are proportions, before being passed to the multinomial log-likelihood function.</p>
<p>Survey age composition is similar but instead of being a function of <span class="math inline">\(F\)</span> it is calculated at the beginning of the year. For survey <span class="math inline">\(k\)</span> the numbers at age are denoted by <span class="math inline">\(\boldsymbol{C^k}_{a,y}\)</span> and calculated following
<span class="math display" id="eq:surveyage">\[\begin{equation}
  \boldsymbol{C^k}_{a,y} = p^s N_{a,y,s} S^k_{y,a,s}
  \tag{3.4}
\end{equation}\]</span></p>
<p>I am not sure exactly what the timing of these surveys are, but do we need to account for som mid-year mortality? or changes in timing of the survey? if so we could easily replace
<span class="math display">\[
N_{a,y,s}
\]</span>
with
<span class="math display">\[
N_{a,y,s} \exp\{-p^k_y Z_{a,y,s}\}
\]</span>
where,<span class="math inline">\(p^k_y\)</span> is the proportion of mortality that we want to account for in year <span class="math inline">\(y\)</span> for survey <span class="math inline">\(k\)</span>.</p>
<p>The survey numbers at age are then adjusted for ageing error and normalised so they sum to one for each year.</p>
</div>
<div id="relative-abundance-indices" class="section level3 unnumbered hasAnchor">
<h3>Relative abundance indices<a href="modeldescription.html#relative-abundance-indices" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display" id="eq:relativeindex">\[\begin{equation}
  \widehat{I}^g_{y} = \sum_s\sum_a p^s N_{a,y,s} \exp \{-0.5 Z_{a,y,s}\} S^g_{y,a,s} \bar{w}_{a,y,s}
  \tag{3.5}
\end{equation}\]</span>
where, <span class="math inline">\(\bar{w}_{a,y,s}\)</span> is mean weight at age, this can be omitted if the observation is in numbers i.e., abundance instead of biomass and <span class="math inline">\(p^s\)</span> is the proportion for each sex. This is currently a user input, but should be dealt within the model either as having different sex selectivities or through the sex ratio of recruitment.</p>
<p>A list of slight improvements</p>
<ul>
<li>change how sex ratio is handled</li>
<li>fishery dependent abundance indices i.e., CPUE change <span class="math inline">\(N_{a,y,s} \exp \{-0.5 Z_{a,y,s}\}\)</span> with <span class="math inline">\(\boldsymbol{C^g}_{a,y,s}\)</span> which is calculated in the catch at age observations.</li>
</ul>
</div>
<div id="catch-at-length" class="section level3 unnumbered hasAnchor">
<h3>Catch at length<a href="modeldescription.html#catch-at-length" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For each year that has a length frequency observation, numbers at length denoted by <span class="math inline">\(\boldsymbol{C^l}_{y,s} = (C^l_{1,y,s}, \dots, C^l_{n_l,y,s})^T\)</span> (dimension of <span class="math inline">\(\boldsymbol{C^l}_{y,s}\)</span> is <span class="math inline">\(n_l \ \times \ 1\)</span>) were calculated for each sex. This involved multiplying the catch at age (see above for how it is calculated) through an age-length transition matrix denoted by <span class="math inline">\(\boldsymbol{A}^l_{y,s}\)</span> (dimensions of <span class="math inline">\(\boldsymbol{A}^l_{y,s}\)</span> are <span class="math inline">\(n_a \ \times \ n_l\)</span> and its rows must sum to 1). The calculation follows Equation <a href="modeldescription.html#eq:agelengthtransition">(3.6)</a>,</p>
<p><span class="math display" id="eq:agelengthtransition">\[\begin{equation}
  \boldsymbol{C^l}_{y,s} =  \left(\boldsymbol{A}^l_{y,s} \right)^T \ \times \ \boldsymbol{C_{y,s}}
  \tag{3.6}
\end{equation}\]</span>
where, <span class="math inline">\(\boldsymbol{C_{y,s}}\)</span> is a column vector of numbers at age (dimension <span class="math inline">\(n_a \ \times \ 1\)</span>) at the beginning of year <span class="math inline">\(y\)</span> for sex <span class="math inline">\(s\)</span>.</p>
</div>
<div id="observations-for-fisheries-and-surveys" class="section level3 unnumbered hasAnchor">
<h3>Observations for fisheries and surveys<a href="modeldescription.html#observations-for-fisheries-and-surveys" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<table>
<colgroup>
<col width="27%" />
<col width="72%" />
</colgroup>
<thead>
<tr class="header">
<th>label</th>
<th>Relative Abundance description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>srv1</code></td>
<td>Biomass domestic longline survey uses both <code>srv1_sel</code> and <code>srv10_sel</code></td>
</tr>
<tr class="even">
<td><code>srv3</code></td>
<td>Abundance domestic longline survey uses both <code>srv1_sel</code> and <code>srv10_sel</code></td>
</tr>
<tr class="odd">
<td><code>srv2</code></td>
<td>Biomass survey uses both <code>srv2_sel</code> and <code>srv9_sel</code></td>
</tr>
<tr class="even">
<td><code>srv4</code></td>
<td>Abundance survey uses both <code>srv2_sel</code> and <code>srv9_sel</code></td>
</tr>
<tr class="odd">
<td><code>srv5</code></td>
<td>Longline fishery CPUE <code>fish1_sel</code>, <code>fish4_sel</code>, <code>fish5_sel</code></td>
</tr>
<tr class="even">
<td><code>srv6</code></td>
<td>Japanese LL fishery CPUE</td>
</tr>
<tr class="odd">
<td><code>srv7</code></td>
<td>NMFS bottom trawl survey (currently GOA only; fit in model)</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="27%" />
<col width="72%" />
</colgroup>
<thead>
<tr class="header">
<th>label</th>
<th>Composition description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>ac_fish1</code></td>
<td>Longline Fishery Age Comp (sex aggregated)</td>
</tr>
<tr class="even">
<td><code>sc_fish1</code></td>
<td>Longline Fishery LF (sex dis-aggregrated)</td>
</tr>
<tr class="odd">
<td><code>sc_fish3</code></td>
<td>Trawl Fishery LF (sex disaggregrated)</td>
</tr>
<tr class="even">
<td><code>sc_fish2</code></td>
<td>LF for japaneses Longline fishery (sex aggregrated) (basically a survey now)</td>
</tr>
<tr class="odd">
<td><code>sc_fish4</code></td>
<td>LF for japaneses Longline fishery (sex aggregrated) (basically a survey now)</td>
</tr>
<tr class="even">
<td><code>fish_size</code></td>
<td>LF From japaneses trawl survey? (sex aggregrated)</td>
</tr>
<tr class="odd">
<td><code>ac_srv1</code></td>
<td>Domestic Longline Survey AF (sex aggregated)</td>
</tr>
<tr class="even">
<td><code>sc_srv1</code></td>
<td>Domestic Longline Survey LF (sex disaggregrated)</td>
</tr>
<tr class="odd">
<td><code>ac_srv2</code></td>
<td>Japanese Longline Survey AF (sex aggregated)</td>
</tr>
<tr class="even">
<td><code>sc_srv2</code></td>
<td>Japanese Longline Survey LF (sex disaggregrated)</td>
</tr>
<tr class="odd">
<td><code>ac_srv7</code></td>
<td>NMFS bottom trawl survey AF (sex aggregated)</td>
</tr>
<tr class="even">
<td><code>sc_srv7</code></td>
<td>NMFS bottom trawl survey LF (sex disaggregrated)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="symbols" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Symbol Notation<a href="modeldescription.html#symbols" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<colgroup>
<col width="27%" />
<col width="72%" />
</colgroup>
<thead>
<tr class="header">
<th>Symbol</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(y\)</span></td>
<td>Year, <span class="math inline">\(y = 1960, \dots, T\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(T\)</span></td>
<td>Terminal year of the model</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(s\)</span></td>
<td>Sex index <span class="math inline">\(s \in \{1,2\}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(r\)</span></td>
<td>Region index <span class="math inline">\(r \in \{1, \dots, n_r\}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(n_r\)</span></td>
<td>number of modeled regions</td>
</tr>
<tr class="even">
<td><span class="math inline">\(a\)</span></td>
<td>Model age cohort, i.e., <span class="math inline">\(a = a_0, a_0 + 1, \dots\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(a_{1}\)</span></td>
<td>Recruitment age to the model = 2</td>
</tr>
<tr class="even">
<td><span class="math inline">\(a_+\)</span></td>
<td>Plus-group age class (oldest age considered plus all older ages)</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(n_a\)</span></td>
<td>Number of age classes modeled <span class="math inline">\(a_+ \ - a_1\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(l\)</span></td>
<td>length class</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(n_l\)</span></td>
<td>Number of length classes</td>
</tr>
<tr class="even">
<td><span class="math inline">\(g\)</span></td>
<td>gear type index, i.e. longline survey, longline fishery, trawl fishery</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(x\)</span></td>
<td>log-likelihoos index</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\bar{w}_{a,y, s}\)</span></td>
<td>Average weight at age <span class="math inline">\(a\)</span>, year <span class="math inline">\(y\)</span> and sex <span class="math inline">\(s\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\phi_{a,y}\)</span></td>
<td>Proportion of female mature by age and year</td>
</tr>
<tr class="even">
<td><span class="math inline">\(p^s_{y}\)</span></td>
<td>Proportion of recruits for sex <span class="math inline">\(s\)</span>. Often assumed = 0.5</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\ln \mu_{r}\)</span></td>
<td>Average log-recruitment</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\ln \mu_{f}\)</span></td>
<td>Average log-fishing mortality</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\phi_{y,g}\)</span></td>
<td>annual fishing mortality deviation by gear (log space)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\tau_{y}\)</span></td>
<td>annual recruitment deviation <span class="math inline">\(\sim LogNormal\left(0,\sigma_r\right)\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\sigma_r\)</span></td>
<td>Recruitment standard deviation</td>
</tr>
<tr class="even">
<td><span class="math inline">\(N_{a,y,s}\)</span></td>
<td>Numbers of fish at age <span class="math inline">\(a\)</span> in year <span class="math inline">\(y\)</span> of sex <span class="math inline">\(s\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(M\)</span></td>
<td>Natural mortality</td>
</tr>
<tr class="even">
<td><span class="math inline">\(F^g_{a,y}\)</span></td>
<td>Fishing mortality for year <span class="math inline">\(y\)</span>, age <span class="math inline">\(a\)</span> and gear <span class="math inline">\(g\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(F_{hist}\)</span></td>
<td>Historical proportion of Fishing mortality</td>
</tr>
<tr class="even">
<td><span class="math inline">\(Z_{a,y}\)</span></td>
<td>Total mortality for year <span class="math inline">\(y\)</span>, age <span class="math inline">\(a\)</span> <span class="math inline">\(=\sum\limits_g F^g_{a,y} + M\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(R_{y}\)</span></td>
<td>Annual recruitment</td>
</tr>
<tr class="even">
<td><span class="math inline">\(B_{y}\)</span></td>
<td>Spawning biomass in year <span class="math inline">\(y\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(S^g_{a,y,s}\)</span></td>
<td>Selectivity at age <span class="math inline">\(a\)</span> for gear type <span class="math inline">\(g\)</span> and sex <span class="math inline">\(s\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(a_50\)</span></td>
<td>age at 50% selection for ascending limb</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(d_50\)</span></td>
<td>age at 50% selection for descending limb</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\delta\)</span></td>
<td>slope/shape parameters for different logistic curves</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\boldsymbol{A}\)</span></td>
<td>ageing-error matrix dimensions <span class="math inline">\(n_a \ \times \ n_a\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\boldsymbol{A}^l_s\)</span></td>
<td>age to length conversion matrix by sex. dimensions <span class="math inline">\(n_a \ \times \ n_l\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(q_g\)</span></td>
<td>abundance index catchability coeffecient by gear</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\lambda_x\)</span></td>
<td>Statistical weight (penalty) for component <span class="math inline">\(x\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(P^g_{l,y,s}\)</span></td>
<td>Observed proportions at length for gear <span class="math inline">\(g\)</span> in year <span class="math inline">\(y\)</span> and sex <span class="math inline">\(s\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(P^g_{a,y,s}\)</span></td>
<td>Observed proportions at age for gear <span class="math inline">\(g\)</span> in year <span class="math inline">\(y\)</span> and sex <span class="math inline">\(s\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\psi^g_{y}\)</span></td>
<td>assumed sample size for gear <span class="math inline">\(g\)</span> in year <span class="math inline">\(y\)</span> (for multinomial likelihood</td>
</tr>
<tr class="even">
<td><span class="math inline">\(n_g\)</span></td>
<td>Number of years that age (or length) composition is available for gear <span class="math inline">\(g\)</span></td>
</tr>
</tbody>
</table>
<div id="inference" class="section level3 unnumbered hasAnchor">
<h3>Inference<a href="modeldescription.html#inference" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If random effects are considered the joint probability model follows,
<span class="math display">\[\begin{equation}
    Pr\left[ \boldsymbol{y^{obs}}, \boldsymbol{u}| \boldsymbol{\theta} \right]  = Pr\left[\boldsymbol{y^{obs}} |\boldsymbol{\theta^f}, \boldsymbol{u} \right] Pr\left[\boldsymbol{u} |\boldsymbol{\theta^h} \right]
    \end{equation}\]</span></p>
<p>Inference is conducted by maximising the marginal likelihood noting <span class="math inline">\(L\left(\boldsymbol{\theta} | \boldsymbol{y^{obs}} \right) \propto Pr\left[ \boldsymbol{y^{obs}} | \boldsymbol{\theta} \right]\)</span>
<span class="math display">\[\begin{equation}\label{eq:marginal_ll}
    L\left(\boldsymbol{\theta} | \boldsymbol{y^{obs}}\right) = \int \left(Pr\left[\boldsymbol{y^{obs}} |\boldsymbol{\theta^f}, \boldsymbol{\theta^g}, \boldsymbol{u} \right] Pr\left[\boldsymbol{u} |\boldsymbol{\theta^h} \right] \right) \boldsymbol{du}
    \end{equation}\]</span>
In general this integral is not tractable, and so approximations are necessary. The software used here implement the Laplace approximation, which relies on Gaussian assumptions.</p>
<p>Maximum Likelihood Estimates (MLE) for fixed effect parameters <span class="math inline">\(\widehat{\boldsymbol{\theta}}_{MLE}\)</span> are evaluated,
<span class="math display">\[\begin{equation}
    \widehat{\boldsymbol{\theta}}_{MLE} = \underset{\boldsymbol{\theta}}{\arg\max} \left( L\left(\boldsymbol{\theta} | \boldsymbol{y^{obs}}\right) \right)
\end{equation}\]</span></p>
<p>and Empirical Bayes estimates are evaluated for <span class="math inline">\(\widehat{\boldsymbol{u}}\)</span>, which are used model diagnostics and other model quantities,
<span class="math display">\[\begin{equation}
\widehat{\boldsymbol{u}} = \underset{\boldsymbol{u}}{\arg\max} \left( Pr\left[ \boldsymbol{y^{obs}}, \boldsymbol{u}| \widehat{\boldsymbol{\theta}}_{MLE} \right] \right)
\end{equation}\]</span></p>
</div>
<div id="todo" class="section level3 unnumbered hasAnchor">
<h3>TODO<a href="modeldescription.html#todo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Build a validate function to help catch users setting up parameters or data structures that will cause a crash once supplied to TMB.</li>
<li>Self test</li>
<li>change some parameter containers. In the ADMB model the often share parameters between male and females. Particularly for selectivity parameters. However TMB will not allow us to fix/map parameters across different arrays or vectors. This means we will want to join the male and female selectivity parameter objects into a single object so that we can share parameters between the sexes.</li>
<li>Change array column casting from <code>vector&lt;Type&gt;(array.col(i))</code> to <code>array.col(i).vec()</code></li>
</ul>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-goethel2021assessment" class="csl-entry">
Goethel, DR, DH Hanselman, CJ Rodgveller, KH Fenski, SK Shotwell, KB Echave, PW Malecha, A Siwicke, and CR Lunsford. 2021. <span>“Assessment of the Sablefish Stock in Alaska.”</span> <em>Stock Assessment and Fishery Evaluation Report for the Groundfish Resources of the Gulf of Alaska and the Bering Sea/Aleutian Islands as Projected for</em>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="objectives.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spatialmodeldescription.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://www.fisheries.noaa.gov/alaska/science-data/alaska-sablefish-fisheries-and-assessment/02-CurrentAssessmentModel.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"depth": 1
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
