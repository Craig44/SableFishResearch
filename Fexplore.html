<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Exploring alternative fishing mortality parameterisations (F) | Alaskan sablefish research</title>
  <meta name="description" content="This Gitbook documents my post-doctoral research relating to Alaskan sablefish." />
  <meta name="generator" content="bookdown 0.30 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Exploring alternative fishing mortality parameterisations (F) | Alaskan sablefish research" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This Gitbook documents my post-doctoral research relating to Alaskan sablefish." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Exploring alternative fishing mortality parameterisations (F) | Alaskan sablefish research" />
  
  <meta name="twitter:description" content="This Gitbook documents my post-doctoral research relating to Alaskan sablefish." />
  

<meta name="author" content="C.Marsh" />


<meta name="date" content="2022-11-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sexratios.html"/>
<link rel="next" href="spatialInit.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Sablefish Research</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#future-things-to-consider"><i class="fa fa-check"></i>Future things to consider</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#chapter-overview"><i class="fa fa-check"></i>chapter overview</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="objectives.html"><a href="objectives.html"><i class="fa fa-check"></i><b>2</b> A list of objectives/milestones that we have set along the project life</a></li>
<li class="chapter" data-level="3" data-path="modeldescription.html"><a href="modeldescription.html"><i class="fa fa-check"></i><b>3</b> Current Alaskan sablefish stock assessment model</a>
<ul>
<li class="chapter" data-level="3.1" data-path="modeldescription.html"><a href="modeldescription.html#modelequations"><i class="fa fa-check"></i><b>3.1</b> Process equations</a>
<ul>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#initialisation-gleft.right"><i class="fa fa-check"></i>Initialisation (<span class="math inline">\(g\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#population-dynamics-fleft.right"><i class="fa fa-check"></i>Population dynamics (<span class="math inline">\(f\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#determining-selectivities-for-fisheries-and-surveys"><i class="fa fa-check"></i>Determining selectivities for fisheries and surveys</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="modeldescription.html"><a href="modeldescription.html#observationsection"><i class="fa fa-check"></i><b>3.2</b> Observation equations</a>
<ul>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#catch-at-age"><i class="fa fa-check"></i>Catch at age</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#relative-abundance-indices"><i class="fa fa-check"></i>Relative abundance indices</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#catch-at-length"><i class="fa fa-check"></i>Catch at length</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#observations-for-fisheries-and-surveys"><i class="fa fa-check"></i>Observations for fisheries and surveys</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="modeldescription.html"><a href="modeldescription.html#symbols"><i class="fa fa-check"></i><b>3.3</b> Symbol Notation</a>
<ul>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#inference"><i class="fa fa-check"></i>Inference</a></li>
<li class="chapter" data-level="" data-path="modeldescription.html"><a href="modeldescription.html#todo"><i class="fa fa-check"></i>TODO</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html"><i class="fa fa-check"></i><b>4</b> Spatial stock assessment model for Alaskan sablefish</a>
<ul>
<li class="chapter" data-level="4.1" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#spatialmodelequations"><i class="fa fa-check"></i><b>4.1</b> Process equations</a>
<ul>
<li class="chapter" data-level="" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#initialisation-gleft.right-1"><i class="fa fa-check"></i>Initialisation (<span class="math inline">\(g\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#population-dynamics-fleft.right-1"><i class="fa fa-check"></i>Population dynamics (<span class="math inline">\(f\left(.\right)\)</span>)</a></li>
<li class="chapter" data-level="" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#to-consider"><i class="fa fa-check"></i>To consider</a></li>
<li class="chapter" data-level="" data-path="spatialmodeldescription.html"><a href="spatialmodeldescription.html#to-do"><i class="fa fa-check"></i>To DO</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sexratios.html"><a href="sexratios.html"><i class="fa fa-check"></i><b>5</b> Sex ratios in age and length composition data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sexratios.html"><a href="sexratios.html#sexSimulation"><i class="fa fa-check"></i><b>5.1</b> A simple simulation</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="sexratios.html"><a href="sexratios.html#results"><i class="fa fa-check"></i><b>5.1.1</b> Results</a></li>
<li class="chapter" data-level="" data-path="sexratios.html"><a href="sexratios.html#future-research-that-was-not-considered-in-this-simple-simulation"><i class="fa fa-check"></i>Future research that was not considered in this simple simulation</a></li>
<li class="chapter" data-level="5.1.2" data-path="sexratios.html"><a href="sexratios.html#scenario-1"><i class="fa fa-check"></i><b>5.1.2</b> Scenario 1</a></li>
<li class="chapter" data-level="5.1.3" data-path="sexratios.html"><a href="sexratios.html#scenario-2"><i class="fa fa-check"></i><b>5.1.3</b> Scenario 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="Fexplore.html"><a href="Fexplore.html"><i class="fa fa-check"></i><b>6</b> Exploring alternative fishing mortality parameterisations (F)</a>
<ul>
<li class="chapter" data-level="" data-path="Fexplore.html"><a href="Fexplore.html#set-up-a-simulation"><i class="fa fa-check"></i>Set up a simulation</a></li>
<li class="chapter" data-level="" data-path="Fexplore.html"><a href="Fexplore.html#appendix---hybrid-approach"><i class="fa fa-check"></i>Appendix - Hybrid approach</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="spatialInit.html"><a href="spatialInit.html"><i class="fa fa-check"></i><b>7</b> Initialising the plus group in spatial models</a></li>
<li class="chapter" data-level="8" data-path="tagdata.html"><a href="tagdata.html"><i class="fa fa-check"></i><b>8</b> Tagging data and studies</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tagdata.html"><a href="tagdata.html#integrating-tagging-observations-in-spatial-age-structured-models"><i class="fa fa-check"></i><b>8.1</b> Integrating tagging observations in spatial age-structured models</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#releasing-tags"><i class="fa fa-check"></i>Releasing tags</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#tag-recovery-observations"><i class="fa fa-check"></i>Tag recovery observations</a></li>
<li class="chapter" data-level="8.2" data-path="tagdata.html"><a href="tagdata.html#growth-estimation-using-the-laslettevesonpolacheck-lep-method"><i class="fa fa-check"></i><b>8.2</b> Growth estimation using the Laslett–Eveson–Polacheck (LEP) method</a>
<ul>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#age-at-length-growth-model"><i class="fa fa-check"></i>Age-at-length growth model</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#tag-recapture-growth-data"><i class="fa fa-check"></i>Tag recapture growth data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#simulation-test-the-lep-method"><i class="fa fa-check"></i>Simulation test the “LEP” method</a></li>
<li class="chapter" data-level="" data-path="tagdata.html"><a href="tagdata.html#next-steps"><i class="fa fa-check"></i>Next steps</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="refpoints.html"><a href="refpoints.html"><i class="fa fa-check"></i><b>9</b> Review/summarise reference points</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://www.fisheries.noaa.gov/alaska/science-data/alaska-sablefish-fisheries-and-assessment" target="blank">NOAA Website</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Alaskan sablefish research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Fexplore" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> Exploring alternative fishing mortality parameterisations (F)<a href="Fexplore.html#Fexplore" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The current Alaskan sablefish stock assessment (Chapter <a href="modeldescription.html#modeldescription">3</a>) estimates annual fishing mortality values for each gear <span class="math inline">\(g\)</span> denoted by <span class="math inline">\(F^g_{y}\)</span>. This parametersation poses to potential problems when considering future assessment models and spatial models. The first is, the number of parameters will increase as the number of gears increase. The fishery is currently going through a transformation whereby there is a switch from longline to pots. The second consideration is how to set this up in a spatially explicit model where catch have an added spatial dimension. There are two alternative approaches to the current approach which treat <span class="math inline">\(F\)</span> as a derived quantity rather than an estimable parameter. The first is to use Newton Raphson method to solve for <span class="math inline">\(F^g_{y}\)</span>. This is the recommended approach in Stock Synthesis <span class="citation">(<a href="#ref-methot2013stock" role="doc-biblioref">Methot Jr and Wetzel 2013</a>)</span>, termed the “hybrid” approach. The previous two methods assume the Baranov catch equation for mortality <span class="citation">(<a href="#ref-baranov1918question" role="doc-biblioref">Baranov 1918</a>)</span>. An alternative is to assume Popes discrete formulation <span class="citation">(<a href="#ref-pope1972investigation" role="doc-biblioref">Pope 1972</a>)</span> which uses exploitation proportions (sometimes called harvest rates or fishing pressure) and has a closed form solution.</p>
<p>A good general overview on these methods can be found in <span class="citation">Branch (<a href="#ref-branch2009differences" role="doc-biblioref">2009</a>)</span>. They describe and compared the continuous Baranov catch equation <span class="citation">(<a href="#ref-baranov1918question" role="doc-biblioref">Baranov 1918</a>)</span> with Pope’s discrete formulation <span class="citation">(<a href="#ref-pope1972investigation" role="doc-biblioref">Pope 1972</a>)</span>. Arguments for using the continuous case is that <span class="math inline">\(M\)</span> and <span class="math inline">\(F\)</span> occur simultaneously, also with the continuous case, <span class="math inline">\(F\)</span> allows for multiple event encounters, this is assuming a fleet has the same selectivity and availability, that a fish that escapes one net can be caught in another. In contrast, the discrete formulation only allows a fish to be caught or escape from an instantaneous event. I have tried to summarize the benefits of the continuous equation in the following list,</p>
<ul>
<li>Allows the entire population to be caught (not sure this is that relevant)</li>
<li>Allows simultaneous <span class="math inline">\(M\)</span> and <span class="math inline">\(F\)</span>, no need to worry about order of operations. From a coding/practical perspective this is quite attractive. Once you have an F and M you can easily derive all mid-mortality quantities. Where as using a <span class="math inline">\(U\)</span> approach you need save the population before and after to interpolate to derive mid-mortality quantities.</li>
<li>The magnitude of <span class="math inline">\(F\)</span> effects composition data, where as in the discrete case, composition is independent of the magniture of <span class="math inline">\(U\)</span>.</li>
<li>Allows for multiple catch events of an individual</li>
<li>Can fit to catch observations thus allows for uncertainty in catches. In practice the uncertainty/variance on catch is very small i.e., coeffecient of variations ranging from 0.01 to 0.1. This essentially states catch is observed with high confidence and in my opinion isn’t that much different to saying catch is known exactly. Note often this high precision on observed catch is needed in order to make the <span class="math inline">\(F\)</span>’s identifiable. This high precision also muddies the “degrees of freedom” for the model. Although the <span class="math inline">\(F\)</span>’s look like independent and free parameters they are heavily constrained by the assumptiosn on observed catch variance.</li>
</ul>
<p>The arguments for the discrete approximation is that there is an analytical solution for <span class="math inline">\(U\)</span> and so is fast to calculate expected catch, where as <span class="math inline">\(F\)</span> has to be either solved numerically or estimated as a free parameter (as mentioned earlier).</p>
<p>Chris Francis’s wrote a response to this paper <span class="citation">(<a href="#ref-francisCommentBranch" role="doc-biblioref">Francis 2010</a>)</span> where he argues the discrete formulation does not preclude the multiple encounters and that only the data can truly tell us which catch equation is the best one to use.</p>
<ul>
<li>Need to make a point about how there may be Automatic differentiation issues with the <span class="math inline">\(U\)</span> approach. Because there is an <code>if(U &gt; 0.99)</code> which can cause a fork in the chain rule which can equal a coding nightmare.</li>
</ul>
<p>The relationship between <span class="math inline">\(F\)</span> (Instantaneous fishing mortality) and <span class="math inline">\(U\)</span> exploitation rate for a simple scenario (single fishery) is illustrated in the following R code.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="Fexplore.html#cb10-1" aria-hidden="true" tabindex="-1"></a>exploitation_rates <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="fl">0.8</span>,<span class="at">by =</span> <span class="fl">0.02</span>)</span>
<span id="cb10-2"><a href="Fexplore.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate F given a U</span></span>
<span id="cb10-3"><a href="Fexplore.html#cb10-3" aria-hidden="true" tabindex="-1"></a>fishing_mortalites <span class="ot">=</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> exploitation_rates)</span>
<span id="cb10-4"><a href="Fexplore.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="do">## back calculate U given a F</span></span>
<span id="cb10-5"><a href="Fexplore.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 - exp(-fishing_mortalites) </span></span></code></pre></div>
<p>The objective of this simulation</p>
<ul>
<li>Is the method efficient i.e., no loss of speed.</li>
<li>Is the method numerically stable (No NaNs during optimization), particularly under high fishing pressure</li>
</ul>
<div class="figure"><span style="display:block;" id="fig:illustrateFvsU"></span>
<img src="_main_files/figure-html/illustrateFvsU-1.png" alt="Illustration of how mortality is applied to an age cohort continuously over time (y)." width="672" />
<p class="caption">
Figure 6.1: Illustration of how mortality is applied to an age cohort continuously over time (y).
</p>
</div>
<div id="set-up-a-simulation" class="section level2 unnumbered hasAnchor">
<h2>Set up a simulation<a href="Fexplore.html#set-up-a-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To explore the above described methods a simple simulation was conducted using a simple age-structured stock assessment operating model. The model assumed 15 seperate fisheries all with a common selectivity. The purpose was to check that the derived methods were reliable (provided unbiased stock quantities) and that they are computationally efficient.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="Fexplore.html#cb11-1" aria-hidden="true" tabindex="-1"></a>bio_params <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb11-2"><a href="Fexplore.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ages =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb11-3"><a href="Fexplore.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">L_inf =</span> <span class="dv">58</span>,</span>
<span id="cb11-4"><a href="Fexplore.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> <span class="fl">0.133</span>,</span>
<span id="cb11-5"><a href="Fexplore.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">t0 =</span> <span class="dv">0</span>,</span>
<span id="cb11-6"><a href="Fexplore.html#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">M =</span> <span class="fl">0.15</span>,</span>
<span id="cb11-7"><a href="Fexplore.html#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fl">2.08e-9</span>, <span class="do">## tonnes</span></span>
<span id="cb11-8"><a href="Fexplore.html#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fl">3.5</span>,</span>
<span id="cb11-9"><a href="Fexplore.html#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">m_a50 =</span> <span class="fl">6.3</span>,</span>
<span id="cb11-10"><a href="Fexplore.html#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">m_ato95 =</span> <span class="fl">1.2</span>,</span>
<span id="cb11-11"><a href="Fexplore.html#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma =</span> <span class="fl">0.6</span>,</span>
<span id="cb11-12"><a href="Fexplore.html#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="fl">0.85</span>,</span>
<span id="cb11-13"><a href="Fexplore.html#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma_r =</span> <span class="fl">0.6</span>,</span>
<span id="cb11-14"><a href="Fexplore.html#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">R0 =</span> <span class="dv">8234132</span>,</span>
<span id="cb11-15"><a href="Fexplore.html#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">plus_group =</span> <span class="dv">1</span> <span class="co"># 0 = No, 1 = Yes</span></span>
<span id="cb11-16"><a href="Fexplore.html#cb11-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-17"><a href="Fexplore.html#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="Fexplore.html#cb11-18" aria-hidden="true" tabindex="-1"></a>other_params <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb11-19"><a href="Fexplore.html#cb11-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">s_a50 =</span> <span class="fl">3.6</span>,</span>
<span id="cb11-20"><a href="Fexplore.html#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">s_ato95 =</span> <span class="dv">2</span>,</span>
<span id="cb11-21"><a href="Fexplore.html#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">s_q =</span> <span class="fl">0.2</span>,</span>
<span id="cb11-22"><a href="Fexplore.html#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">f_a50 =</span> <span class="dv">5</span>,</span>
<span id="cb11-23"><a href="Fexplore.html#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">f_ato95 =</span> <span class="dv">2</span>,</span>
<span id="cb11-24"><a href="Fexplore.html#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">ssb_prop_Z =</span> <span class="fl">0.5</span>,</span>
<span id="cb11-25"><a href="Fexplore.html#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey_prop_Z =</span> <span class="fl">0.5</span>,</span>
<span id="cb11-26"><a href="Fexplore.html#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey_age_error =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.4</span>),  <span class="do">## sd, rho (ignored if iid)</span></span>
<span id="cb11-27"><a href="Fexplore.html#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">fishery_age_error =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.4</span>),  <span class="do">## sd, rho (ignored if iid)</span></span>
<span id="cb11-28"><a href="Fexplore.html#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">survey_bio_cv =</span> <span class="fu">c</span>(<span class="fl">0.1</span>)</span>
<span id="cb11-29"><a href="Fexplore.html#cb11-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-30"><a href="Fexplore.html#cb11-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-31"><a href="Fexplore.html#cb11-31" aria-hidden="true" tabindex="-1"></a>ages <span class="ot">=</span> bio_params<span class="sc">$</span>ages</span>
<span id="cb11-32"><a href="Fexplore.html#cb11-32" aria-hidden="true" tabindex="-1"></a>max_age <span class="ot">=</span> <span class="fu">max</span>(bio_params<span class="sc">$</span>ages)</span>
<span id="cb11-33"><a href="Fexplore.html#cb11-33" aria-hidden="true" tabindex="-1"></a>n_years <span class="ot">=</span> <span class="dv">30</span></span>
<span id="cb11-34"><a href="Fexplore.html#cb11-34" aria-hidden="true" tabindex="-1"></a>years <span class="ot">=</span> (<span class="dv">2020</span> <span class="sc">-</span> n_years <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">2020</span></span>
<span id="cb11-35"><a href="Fexplore.html#cb11-35" aria-hidden="true" tabindex="-1"></a>n_ages <span class="ot">=</span> <span class="fu">length</span>(ages)</span>
<span id="cb11-36"><a href="Fexplore.html#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="do">## annual fishing mortality</span></span>
<span id="cb11-37"><a href="Fexplore.html#cb11-37" aria-hidden="true" tabindex="-1"></a>start_F <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rlnorm</span>(<span class="dv">10</span>, <span class="fu">log</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.05</span>, <span class="at">to =</span> <span class="fl">0.2</span>, <span class="at">length =</span> <span class="dv">10</span>)), <span class="fl">0.1</span>), <span class="fu">rlnorm</span>(<span class="dv">10</span>, <span class="fu">log</span>(<span class="fl">0.13</span>), <span class="fl">0.1</span>), <span class="fu">rlnorm</span>(<span class="dv">10</span>, <span class="fu">log</span>(<span class="fl">0.07</span>), <span class="fl">0.1</span>))</span>
<span id="cb11-38"><a href="Fexplore.html#cb11-38" aria-hidden="true" tabindex="-1"></a>recruit_devs <span class="ot">=</span> <span class="fu">log</span>(<span class="fu">rlnorm</span>(n_years, <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">*</span> bio_params<span class="sc">$</span>sigma_r <span class="sc">*</span> bio_params<span class="sc">$</span>sigma_r, bio_params<span class="sc">$</span>sigma_r))</span>
<span id="cb11-39"><a href="Fexplore.html#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="Fexplore.html#cb11-40" aria-hidden="true" tabindex="-1"></a>length_at_age <span class="ot">=</span> <span class="fu">vonbert</span>(bio_params<span class="sc">$</span>ages, bio_params<span class="sc">$</span>K, bio_params<span class="sc">$</span>L_inf, bio_params<span class="sc">$</span>t0)</span>
<span id="cb11-41"><a href="Fexplore.html#cb11-41" aria-hidden="true" tabindex="-1"></a>fishery_ogive <span class="ot">=</span> <span class="fu">logis</span>(bio_params<span class="sc">$</span>ages, other_params<span class="sc">$</span>f_a50, other_params<span class="sc">$</span>f_ato95)</span>
<span id="cb11-42"><a href="Fexplore.html#cb11-42" aria-hidden="true" tabindex="-1"></a>survey_ogive <span class="ot">=</span> <span class="fu">logis</span>(bio_params<span class="sc">$</span>ages, other_params<span class="sc">$</span>s_a50, other_params<span class="sc">$</span>s_ato95)</span>
<span id="cb11-43"><a href="Fexplore.html#cb11-43" aria-hidden="true" tabindex="-1"></a>mat_age <span class="ot">=</span> <span class="fu">logis</span>(bio_params<span class="sc">$</span>ages, bio_params<span class="sc">$</span>m_a50, bio_params<span class="sc">$</span>m_ato95)</span>
<span id="cb11-44"><a href="Fexplore.html#cb11-44" aria-hidden="true" tabindex="-1"></a>weight_at_age <span class="ot">=</span> bio_params<span class="sc">$</span>a <span class="sc">*</span> length_at_age<span class="sc">^</span>bio_params<span class="sc">$</span>b</span>
<span id="cb11-45"><a href="Fexplore.html#cb11-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-46"><a href="Fexplore.html#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="do">## observation temporal frequency</span></span>
<span id="cb11-47"><a href="Fexplore.html#cb11-47" aria-hidden="true" tabindex="-1"></a>survey_year_obs <span class="ot">=</span> years</span>
<span id="cb11-48"><a href="Fexplore.html#cb11-48" aria-hidden="true" tabindex="-1"></a>survey_ages <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb11-49"><a href="Fexplore.html#cb11-49" aria-hidden="true" tabindex="-1"></a>fishery_year_obs <span class="ot">=</span> years</span>
<span id="cb11-50"><a href="Fexplore.html#cb11-50" aria-hidden="true" tabindex="-1"></a>fishery_ages <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="Fexplore.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## simulate data</span></span>
<span id="cb12-2"><a href="Fexplore.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb12-3"><a href="Fexplore.html#cb12-3" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">=</span> ASM_obj<span class="sc">$</span><span class="fu">simulate</span>(<span class="at">complete =</span> T)</span>
<span id="cb12-4"><a href="Fexplore.html#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="Fexplore.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Build AD TMB functions</span></span>
<span id="cb12-6"><a href="Fexplore.html#cb12-6" aria-hidden="true" tabindex="-1"></a>start_pars <span class="ot">=</span> <span class="fu">ran_start_vals</span>()</span>
<span id="cb12-7"><a href="Fexplore.html#cb12-7" aria-hidden="true" tabindex="-1"></a>est_model_est_F <span class="ot">=</span> <span class="fu">MakeADFun</span>(sim_data, true_pars, <span class="at">DLL=</span> <span class="st">&quot;SimpleAgestructuredModelMultiFs&quot;</span>, <span class="at">map =</span> na_map, <span class="at">silent =</span> T)</span>
<span id="cb12-8"><a href="Fexplore.html#cb12-8" aria-hidden="true" tabindex="-1"></a>sim_data<span class="sc">$</span>F_method <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb12-9"><a href="Fexplore.html#cb12-9" aria-hidden="true" tabindex="-1"></a>sim_data<span class="sc">$</span>F_iterations <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb12-10"><a href="Fexplore.html#cb12-10" aria-hidden="true" tabindex="-1"></a>est_model_hybrid_F <span class="ot">=</span> <span class="fu">MakeADFun</span>(sim_data, true_pars, <span class="at">DLL=</span> <span class="st">&quot;SimpleAgestructuredModelMultiFs&quot;</span>, <span class="at">map =</span> na_map_hybrid, <span class="at">silent =</span> T)</span>
<span id="cb12-11"><a href="Fexplore.html#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="do">## optimise</span></span>
<span id="cb12-12"><a href="Fexplore.html#cb12-12" aria-hidden="true" tabindex="-1"></a>opt_model_est_F <span class="ot">=</span> <span class="fu">nlminb</span>(est_model_est_F<span class="sc">$</span>par, est_model_est_F<span class="sc">$</span>fn, est_model_est_F<span class="sc">$</span>gr, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">iter.max =</span> <span class="dv">10000</span>, <span class="at">eval.max =</span> <span class="dv">10000</span>))</span>
<span id="cb12-13"><a href="Fexplore.html#cb12-13" aria-hidden="true" tabindex="-1"></a>opt_model_hybrid_F <span class="ot">=</span> <span class="fu">nlminb</span>(est_model_hybrid_F<span class="sc">$</span>par, est_model_hybrid_F<span class="sc">$</span>fn, est_model_hybrid_F<span class="sc">$</span>gr, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">iter.max =</span> <span class="dv">10000</span>, <span class="at">eval.max =</span> <span class="dv">10000</span>))</span>
<span id="cb12-14"><a href="Fexplore.html#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="Fexplore.html#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="do">## look at the number of iterations used to solve</span></span>
<span id="cb12-16"><a href="Fexplore.html#cb12-16" aria-hidden="true" tabindex="-1"></a>opt_model_hybrid_F<span class="sc">$</span>iterations</span></code></pre></div>
<pre><code>## [1] 187</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="Fexplore.html#cb14-1" aria-hidden="true" tabindex="-1"></a>opt_model_est_F<span class="sc">$</span>iterations</span></code></pre></div>
<pre><code>## [1] 673</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="Fexplore.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">## get reports = </span></span>
<span id="cb16-2"><a href="Fexplore.html#cb16-2" aria-hidden="true" tabindex="-1"></a>rep_est_hybrid <span class="ot">=</span> est_model_hybrid_F<span class="sc">$</span><span class="fu">report</span>(est_model_hybrid_F<span class="sc">$</span>env<span class="sc">$</span>last.par.best)</span>
<span id="cb16-3"><a href="Fexplore.html#cb16-3" aria-hidden="true" tabindex="-1"></a>rep_est_F <span class="ot">=</span> est_model_est_F<span class="sc">$</span><span class="fu">report</span>(est_model_est_F<span class="sc">$</span>env<span class="sc">$</span>last.par.best)</span>
<span id="cb16-4"><a href="Fexplore.html#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="Fexplore.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(TMB_data<span class="sc">$</span>years, rep_est_hybrid<span class="sc">$</span>ssb[<span class="sc">-</span><span class="dv">1</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">xlab =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;SSB&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">46000</span>))</span>
<span id="cb16-6"><a href="Fexplore.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(TMB_data<span class="sc">$</span>years, rep_est_F<span class="sc">$</span>ssb[<span class="sc">-</span><span class="dv">1</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;purple&quot;</span>)</span>
<span id="cb16-7"><a href="Fexplore.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(TMB_data<span class="sc">$</span>years, sim_data<span class="sc">$</span>ssb[<span class="sc">-</span><span class="dv">1</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">4</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb16-8"><a href="Fexplore.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;purple&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;Hybrid&quot;</span>, <span class="st">&quot;Est F&quot;</span>, <span class="st">&quot;OM&quot;</span>), <span class="at">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/self_test-1.png" width="672" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="Fexplore.html#cb17-1" aria-hidden="true" tabindex="-1"></a>est_F_bench <span class="ot">=</span> <span class="fu">benchmark</span>(<span class="at">obj =</span> est_model_est_F, <span class="at">n =</span> <span class="dv">1000</span>)</span>
<span id="cb17-2"><a href="Fexplore.html#cb17-2" aria-hidden="true" tabindex="-1"></a>hybrid_F_bench <span class="ot">=</span> <span class="fu">benchmark</span>(<span class="at">obj =</span> est_model_hybrid_F, <span class="at">n =</span> <span class="dv">1000</span>)</span>
<span id="cb17-3"><a href="Fexplore.html#cb17-3" aria-hidden="true" tabindex="-1"></a>est_F_bench</span></code></pre></div>
<pre><code>##                     elapsed
## template.likelihood   0.901
## template.gradient     1.808</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="Fexplore.html#cb19-1" aria-hidden="true" tabindex="-1"></a>hybrid_F_bench</span></code></pre></div>
<pre><code>##                     elapsed
## template.likelihood   2.377
## template.gradient     4.844</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="Fexplore.html#cb21-1" aria-hidden="true" tabindex="-1"></a>ben_est_F <span class="ot">&lt;-</span> <span class="fu">benchmark</span>(<span class="at">obj =</span> est_model_est_F, <span class="at">n=</span><span class="dv">20</span>,<span class="at">expr=</span><span class="fu">expression</span>(<span class="fu">do.call</span>(<span class="st">&quot;optim&quot;</span>,obj)))</span>
<span id="cb21-2"><a href="Fexplore.html#cb21-2" aria-hidden="true" tabindex="-1"></a>ben_hybrid_F <span class="ot">&lt;-</span> <span class="fu">benchmark</span>(<span class="at">obj =</span> est_model_hybrid_F, <span class="at">n=</span><span class="dv">20</span>,<span class="at">expr=</span><span class="fu">expression</span>(<span class="fu">do.call</span>(<span class="st">&quot;optim&quot;</span>,obj)))</span>
<span id="cb21-3"><a href="Fexplore.html#cb21-3" aria-hidden="true" tabindex="-1"></a>ben_est_F</span></code></pre></div>
<pre><code>##                       elapsed
## do.call(&quot;optim&quot;, obj)  16.636</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="Fexplore.html#cb23-1" aria-hidden="true" tabindex="-1"></a>ben_hybrid_F</span></code></pre></div>
<pre><code>##                       elapsed
## do.call(&quot;optim&quot;, obj)  13.273</code></pre>
<p>These results have highlighted the following</p>
<ul>
<li>Both the Free <span class="math inline">\(F\)</span> and hybrid estimate very similar model quantities i.e., SSB’s and F’s</li>
<li>The Free <span class="math inline">\(F\)</span> method is much faster on average for a single gradient calculation and function call compared to the hybrid method</li>
<li>However, the hybrid method requires less iterations due to there being less estimated parameters. For this simulation where we assumed 15 fisheries both optimised in similar amounts of time</li>
</ul>
</div>
<div id="appendix---hybrid-approach" class="section level2 unnumbered hasAnchor">
<h2>Appendix - Hybrid approach<a href="Fexplore.html#appendix---hybrid-approach" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The hybrid fishing mortality process uses the methods and algorithms applied in Stock Synthesis <span class="citation">(<a href="#ref-methot2013stock" role="doc-biblioref">Methot Jr and Wetzel 2013</a>)</span>. The descriptions below are heavily based on the text describing this approach in the Appendix of <span class="citation">(<a href="#ref-methot2013stock" role="doc-biblioref">Methot Jr and Wetzel 2013</a>)</span>.</p>
<p>This process begins by calculating popes discrete approximation, and then converts this to Baranov fishing mortality coefficients. A tuning algorithm is then done to tune these coefficients to match input catch nearly exactly, rather than the full Baranov approach.</p>
<p>Total mortality, denoted by <span class="math inline">\(Z_{a,y,s,r}\)</span> for sex <span class="math inline">\(s\)</span>, region <span class="math inline">\(r\)</span>, age <span class="math inline">\(a\)</span> and year <span class="math inline">\(y\)</span> will hereby be denoted by <span class="math inline">\(Z_{a,y,s}\)</span> i.e., drop the region index. This is because mortality rates are calculated independently (in isolation) among regions (<strong>NOTE</strong> consider parallelising this in the model).</p>
<p><span class="math display">\[\begin{equation*}
    Z_{a,y,s} = M_{a,y,s} + \sum\limits_{f} S^g_{y,s} F^g_y
\end{equation*}\]</span></p>
<p>where, <span class="math inline">\(M_{a,s}\)</span> is the natural mortality rate, <span class="math inline">\(F^g_y\)</span> is fishing mortality and <span class="math inline">\(S^g_{a,s}\)</span> is the selectivity.</p>
<p>The hybrid fishing mortality method allows the <span class="math inline">\(F\)</span> values to be “tuned” to match input catch nearly exactly, rather than estimating them as free model parameters. The process begins by calculating mid year exploitation rate using Pope’s approximation. This exploitation rate is then converted to an approximation of the Baranov continuous <span class="math inline">\(F\)</span>. The <span class="math inline">\(F\)</span> values for all fisheries operating in that year and region are then tuned over a set number of iterations (<code>f_iterations</code>) to match the observed catch for each fishery with its corresponding <span class="math inline">\(F\)</span>. Differentiability is achieved by the use of Pope’s approximation to obtain the starting value for each <span class="math inline">\(F\)</span> and then the use of a fixed number of tuning iterations, typically 4. Tests from Stock Synthesis have shown that modelling <span class="math inline">\(F\)</span> as hybrid versus <span class="math inline">\(F\)</span> as a parameter has trivial impact on the estimates of the variances of other model derived quantities.</p>
<p>The hybrid method calculates the harvest rate using the Pope’s approximation then converts to an approximation of the corresponding F as:</p>
<p><span class="math display">\[\begin{align}
    V^g_{y} &amp;= \sum\limits_s\sum\limits_a N_{a,y,s} \exp\left(-\delta_t M_{a,s}\right) \nonumber \\
    \tilde{U}^g_{y} &amp;= \frac{C^g_{y}}{V^g_{y} + 0.1 C^g_{y}}\\
    j^g_{y} &amp;= \left(1 + \exp \left(30 (\tilde{U}^g_{y} - 0.95) \right)\right)^{-1}\\
    U^g_{y} &amp;=  j^g_{y} \tilde{U}^g_{y} + 0.95 (1 - j^g_{y} )\\
    \tilde{F}^g_{y} &amp;= \frac{-\log\left(1 - U^g_{y}\right)}{\delta_t}
\end{align}\]</span></p>
<p>where, <span class="math inline">\(C^{g}_y\)</span> is the observed catch, <span class="math inline">\(\delta_t\)</span> is the duration of the period of observation within the year. In most situations where the entire catch has been observed in a time-step. This should be one. <span class="math inline">\(V^g_{y}\)</span> is partway vulnerable biomass and <span class="math inline">\(\tilde{F}^g_{y}\)</span> is the initial <span class="math inline">\(F\)</span>.</p>
<p>The formulation above is designed so that high exploitation rates (above 0.95) are converted into an F that corresponds to a harvest rate of close to 0.95, thus providing a more robust starting point for subsequent iterative adjustment of this F. The logistic joiner, <span class="math inline">\(j\)</span>, is used at other places in Stock Synthesis to link across discontinuities.</p>
<p>The tuning algorithm begins by setting <span class="math inline">\(F^g_{y} = \tilde{F}^g_{y}\)</span> and repeating the following algorithm <code>f_iteration</code> times.</p>
<p><span class="math display">\[
\widehat{C}_{a,y,s}  = \sum\limits_g {F}^g_{y}S^g_{a,s} N_{a,y,s}\bar{w}_{a,y,s} \lambda^*_{a,y,s}
\]</span></p>
<p>where, <span class="math inline">\(\lambda^*_{a,y,s}\)</span> denotes the survivorship and is calculated as:</p>
<p><span class="math display" id="eq:survival">\[\begin{equation}
\lambda^*_{a,y,s} = \frac{1 - \exp\left(-\delta_t Z_{a,y,s}  \right) }{Z_{a,y,s}}
   \tag{6.1}
\end{equation}\]</span></p>
<p>Total fishing mortality is then adjusted over several fixed number of iterations (typically four, but more in high F and multiple fishery situations). The first step is to calculate the ratio of the total observed catch over all fleets to the predicted total catch according to the current F estimates. This ratio provides an overall adjustment factor to bring the total mortality closer to what it will be after adjusting the individual <span class="math inline">\(F\)</span> values.</p>
<p><span class="math display">\[
\widehat{C}_{y}  =  \sum\limits_g \sum\limits_s\sum\limits_a {F}^g_{y}\left(S^g_{a,s} N_{a,y,s}\right) \lambda^*_{a,y,s}
\]</span></p>
<p>This is different from Equation A.1.25 in the Appendix of <span class="citation">(<a href="#ref-methot2013stock" role="doc-biblioref">Methot Jr and Wetzel 2013</a>)</span>. They include <span class="math inline">\(Z_{a,y,s}\)</span> in the denominator when describing <span class="math inline">\({F}^g_{y}\)</span>, I think this is a typo error because <span class="math inline">\(Z_{a,y,s}\)</span> is already included in the denominator when calculating <span class="math inline">\(\lambda^*_{a,y,s}\)</span> (see Equation <a href="Fexplore.html#eq:survival">(6.1)</a>).</p>
<p><span class="math display">\[
Z^{adj}_y = \frac{\sum\limits_g C^g_{y}}{\widehat{C}_{y}}
\]</span></p>
<p>The total mortality if this adjuster was applied to all the Fs is then calculated:</p>
<p><span class="math display">\[
Z^*_{a,y,s} = M_{a,s} + Z^{adj}_y \left(Z_{a,y,s} -M_{a,s} \right)
\]</span></p>
<p><span class="math display">\[
\lambda^*_{a,y,s} = \frac{1 - \exp\left(-\delta_t Z^*_{a,y,s}  \right) }{Z^*_{a,y,s}}
\]</span></p>
<p>The adjusted mortality rate is used to calculate the total removals for each fishery, and then the new <span class="math inline">\(F\)</span> estimate is calculated by the ratio of observed catch to total removals, with a constraint to prevent unreasonably high <span class="math inline">\(F\)</span> calculations (<code>max_f</code>):</p>
<p><span class="math display">\[\begin{align*}
    \tilde{V}^g_{y} &amp;= \sum\limits_s\sum\limits_a \left(N_{a,y,s} \bar{w}_{a,y,s}S^g_{a,s} \right)\lambda^*_{a,y,s} \\
    F^{g*}_{y} &amp;= \frac{C^g_{y}}{\tilde{V}^g_{y} + 0.0001}\\
    j^{g*}_{y} &amp;= \left(1 + \exp \left(30 (F^{g*}_{y} - 0.95 F_{max}) \right)\right)^{-1}\\
\end{align*}\]</span></p>
<p>where, <span class="math inline">\(F_{max}\)</span> is a user defined maximum fishing mortality <code>f_max</code>. The <span class="math inline">\(F\)</span> at the end of each tuning iteration follows:</p>
<p><span class="math display">\[
F^g_{y} = j^{g*}_{y} F^{g*}_{y} + \left(1 - j^{g*}_{y}\right)F_{max}
\]</span></p>
<p>After the tuning algorithm removals at age, and other derived quantities are recorded. The final total mortality is updated
<span class="math display">\[
    Z_{a,y,s} = M_{a,s} + \sum\limits_{g} S^g_{a,s} F^g_{y}
\]</span></p>
<p>This process generates catch at age and sex for each year (and region) (<span class="math inline">\(\widehat{C}^g_{a,y,s}\)</span>) which can be accessed by <code>process_removals</code> observations. Numbers at age are calculated as</p>
<p><span class="math display">\[
\widehat{C}^g_{a,y,s} = \frac{F^g_{a,s,y}}{Z_{a,y,s}} N_{a,y,s} \exp\left(-Z_{a,y,s}\right)
\]</span></p>
<p>Total catch is the summed over all sexes and age</p>
<p><span class="math display">\[
\widehat{C}^g_{y} = \sum\limits_s\sum\limits_a \widehat{C}^g_{a,y,s}  \bar{w}_{a,y,s}
\]</span></p>
<p>where <span class="math inline">\(\bar{w}_{a,y,s}\)</span> is the mean weight</p>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-baranov1918question" class="csl-entry">
Baranov, TI. 1918. <span>“On the Question of the Biological Basis of Fisheries.”</span> <em>Nauchnyi Issledovatelskii Ikhtiologicheskii Institut Isvestia</em> 1: 81–128.
</div>
<div id="ref-branch2009differences" class="csl-entry">
Branch, Trevor A. 2009. <span>“Differences in Predicted Catch Composition Between Two Widely Used Catch Equation Formulations.”</span> <em>Canadian Journal of Fisheries and Aquatic Sciences</em> 66 (1): 126–32.
</div>
<div id="ref-francisCommentBranch" class="csl-entry">
Francis, R I C Chris. 2010. <span>“Comment on "<span>D</span>ifferences in Predicted Catch Composition Between Two Widely Used Catch Equation Formulations".”</span> <em>Canadian Journal of Fisheries and Aquatic Sciences</em> 67 (4): 763–65.
</div>
<div id="ref-methot2013stock" class="csl-entry">
Methot Jr, Richard D, and Chantell R Wetzel. 2013. <span>“Stock Synthesis: A Biological and Statistical Framework for Fish Stock Assessment and Fishery Management.”</span> <em>Fisheries Research</em> 142: 86–99.
</div>
<div id="ref-pope1972investigation" class="csl-entry">
Pope, JG. 1972. <span>“An Investigation of the Accuracy of Virtual Population Analysis Using Cohort Analysis.”</span> <em>ICNAF Research Bulletin</em> 9 (10): 65–74.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sexratios.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spatialInit.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://www.fisheries.noaa.gov/alaska/science-data/alaska-sablefish-fisheries-and-assessment/05-ExploreFParameterisations.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"depth": 1
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
